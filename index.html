<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All InfoZone & Hisab (Personal AI V5 - Ultimate Fixed)</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Tesseract.js -->
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    <!-- QR Scanner Library -->
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <!-- QR Generator Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <style>
        :root {
            /* --- THEME COLORS --- */
            --primary: #21D4FD; 
            --secondary: #B721FF; 
            --accent: #f72585;
            --success: #10B981; 
            --danger: #e63946; 
            --text-light: #f0f2f5;
            --component-bg: rgba(23, 28, 44, 0.6); 
            --border-color: rgba(255, 255, 255, 0.18);
            --border-radius: 16px; 
            --box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            --bottom-nav-height: 70px; 
            --transition: all 0.3s ease-in-out;
            --bank-color: #4F46E5; 
            --goal-color: #EA580C; 
            --dps-color: #7C3AED;
            --loading-bg: #050510;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif; color: var(--text-light);
            background: linear-gradient(320deg, #1d2b64 0%, #000000 50%, #f8cdda 100%);
            background-size: 200% 200%; animation: cosmic-bg 25s ease infinite;
            min-height: 100vh; padding-bottom: var(--bottom-nav-height); 
        }
        @keyframes cosmic-bg { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .glass-ui {
            background: var(--component-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border-radius: var(--border-radius); border: 1px solid var(--border-color); box-shadow: var(--box-shadow);
        }
        
        /* LOADING SCREEN */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--loading-bg); 
            z-index: 9999;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            transition: opacity 0.5s ease-out;
        }
        .tech-loader { position: relative; width: 100px; height: 100px; display: flex; justify-content: center; align-items: center; }
        .tech-ring { position: absolute; border-radius: 50%; border: 2px solid transparent; }
        .tr-1 { width: 100%; height: 100%; border-top: 4px solid var(--primary); border-bottom: 4px solid var(--primary); box-shadow: 0 0 15px var(--primary); animation: spin 1.5s linear infinite; }
        .tr-2 { width: 70%; height: 70%; border-left: 4px solid var(--secondary); border-right: 4px solid var(--secondary); box-shadow: 0 0 10px var(--secondary); animation: spin-reverse 1s linear infinite; }
        .tr-dot { width: 20%; height: 20%; background: var(--accent); border-radius: 50%; box-shadow: 0 0 20px var(--accent); animation: pulse 1s ease-in-out infinite; }
        .loading-text { margin-top: 30px; color: var(--primary); font-size: 1rem; font-weight: 600; letter-spacing: 3px; text-transform: uppercase; text-shadow: 0 0 10px var(--primary); animation: pulse 1.5s ease-in-out infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes spin-reverse { 0% { transform: rotate(0deg); } 100% { transform: rotate(-360deg); } }
        @keyframes pulse { 0% { opacity: 0.5; transform: scale(0.9); } 50% { opacity: 1; transform: scale(1.1); } 100% { opacity: 0.5; transform: scale(0.9); } }

        /* Login Styles */
        #login-page { display: flex; justify-content: center; align-items: center; min-height: 100vh; width: 100%; padding: 1rem; }
        .login-container { width: 100%; max-width: 400px; padding: 2rem; }
        .login-container h2 { color: var(--primary); margin-bottom: 1.5rem; text-align: center; }
        #login-error { color: var(--danger); text-align: center; margin-bottom: 1rem; height: 20px; }
        .password-container { position: relative; }
        .password-toggle { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--primary); z-index: 10; font-size: 1.1rem; }
        .btn { background: rgba(255, 255, 255, 0.1); border: 1px solid var(--border-color); color: var(--text-light); padding: 12px 25px; border-radius: 12px; font-weight: 500; cursor: pointer; transition: var(--transition); width: 100%; font-family: 'Poppins', sans-serif; }
        .btn:hover { background: var(--primary); color: #000; box-shadow: 0 0 15px var(--primary); }
        .process-btn { background: var(--secondary); color: white; margin-top: 5px; margin-bottom: 15px; }
        .process-btn:hover { background: var(--accent); }
        .ai-btn { background: linear-gradient(90deg, #FF3CAC 0%, #784BA0 50%, #2B86C5 100%); color: white; border: none; font-weight: bold; margin-bottom: 10px; }
        .ai-btn:hover { box-shadow: 0 0 20px rgba(183, 33, 255, 0.6); transform: scale(1.02); }

        #admin-panel { display: none; }
        .topbar { display: flex; align-items: center; justify-content: space-between; padding: 1rem 1.5rem; z-index: 1000; margin: 0 1rem; margin-top: 1rem; }
        .topbar h2 { color: var(--primary); font-size: 1.5rem; font-weight: 700; text-shadow: 0 0 10px rgba(33, 212, 253, 0.4); }
        .top-actions { display: flex; align-items: center; gap: 10px; }
        .logout-btn { background: none; border: 1px solid var(--danger); color: var(--danger); border-radius: 50px; padding: 8px 15px; cursor: pointer; transition: 0.3s; }
        .logout-btn:hover { background: var(--danger); color: white; }
        .about-toggle-btn { background: rgba(33, 212, 253, 0.1); border: 1px solid var(--primary); color: var(--primary); width: 38px; height: 38px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; }
        .about-toggle-btn:hover { background: var(--primary); color: #000; box-shadow: 0 0 10px var(--primary); }

        .content { padding: 1rem; }
        .page-content { display: none; } 
        .page-content.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .bottom-nav { 
    position: fixed; bottom: 0; left: 0; right: 0; 
    height: calc(var(--bottom-nav-height) + env(safe-area-inset-bottom));
    padding-bottom: env(safe-area-inset-bottom);
    display: flex; justify-content: space-around; z-index: 1000; overflow-x: auto; 
}
        .bottom-nav a { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; color: rgba(255, 255, 255, 0.7); text-decoration: none; font-size: 0.6rem; transition: var(--transition); text-align: center; min-width: 60px; }
        .bottom-nav a i { font-size: 1.3rem; margin-bottom: 4px; }
        .bottom-nav a.active { color: var(--primary); transform: translateY(-5px); }
        .bottom-nav a.active i { text-shadow: 0 0 10px var(--primary); }

        .stats-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .info-table { width: 100%; border-collapse: collapse; min-width: 500px; }
        .info-table th, .info-table td { padding: 0.8rem; text-align: left; border-bottom: 1px solid var(--border-color); font-size: 0.9rem; white-space: nowrap; }
        .info-table th { color: var(--primary); }
        .info-table tr:hover { background-color: rgba(255, 255, 255, 0.05); }

        .action-buttons { display: flex; gap: 0.5rem; align-items: center; justify-content: flex-end; }
        .open-btn { background: none; border: 1px solid var(--success); color: var(--success); padding: 5px 10px; border-radius: 8px; cursor: pointer; font-size: 0.8rem; }
        .edit-btn, .delete-btn { background: none; border: none; cursor: pointer; font-size: 1.1rem; padding: 5px; }
        .edit-btn { color: var(--primary); } .delete-btn { color: var(--danger); }

        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.8rem 1rem; background-color: rgba(0, 0, 0, 0.2); border: 1px solid var(--border-color); border-radius: 8px; font-size: 1rem; color: var(--text-light); }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 10px var(--primary); }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; padding: 1rem; }
        .modal-content { color: var(--text-light); width: 100%; max-width: 500px; padding: 1.5rem; max-height: 90vh; overflow-y: auto; scrollbar-width: thin; background: linear-gradient(145deg, rgba(23, 28, 44, 0.95), rgba(10, 10, 20, 0.98)); border: 1px solid var(--primary); box-shadow: 0 0 40px rgba(33, 212, 253, 0.2); border-radius: 20px; }
        
        /* QR Modal */
        #qr-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 6000; justify-content: center; align-items: center; flex-direction: column; }
        #reader { width: 300px; height: 300px; background: black; border: 2px solid var(--primary); border-radius: 10px; margin-bottom: 20px;}
        .chat-opt-btn { background: linear-gradient(135deg, #00C6FF, #0072FF); border: none; padding: 8px 15px; color: white; border-radius: 20px; margin: 5px; cursor: pointer; font-size: 0.8rem; }

        .phone-input-group, .social-input-group, .mail-input-group, .bulk-contact-row { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
        .phone-input-group input, .social-input-group input, .mail-input-group input, .bulk-contact-row input { flex-grow: 1; }
        .remove-btn { background-color: var(--danger) !important; border-color: var(--danger) !important; color: white; }
        .mail-entry-box { padding: 1rem; margin-bottom: 1rem; border: 1px solid var(--border-color); border-radius: var(--border-radius); }
        .mail-row-compact { display: flex; align-items: center; justify-content: space-between; background: rgba(0,0,0,0.2); padding: 0.5rem; border-radius: 8px; margin-bottom: 0.5rem; }
        .copy-btn-small { background: none; border: 1px solid var(--primary); color: var(--primary); cursor: pointer; padding: 4px 8px; border-radius: 5px; margin-left: 5px; }
        
        .category-filters { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 1.5rem; justify-content: center; }
        .category-filters .btn { width: auto; }
        .category-filters .btn.active { background: var(--primary); color: #000; box-shadow: 0 0 15px var(--primary); }
        .search-controls { display: flex; flex-direction: column; gap: 1rem; margin-bottom: 1rem; }
        .toggle-label { display: flex; align-items: center; cursor: pointer; gap: 10px; margin-bottom: 15px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; }
        .toggle-label input { width: auto; margin: 0; }

        /* Hisab Colors & Style */
        .hisab-tabs { display: flex; overflow-x: auto; gap: 10px; margin-bottom: 20px; padding-bottom: 5px; }
        .hisab-tab { white-space: nowrap; padding: 8px 16px; border-radius: 20px; background: rgba(255,255,255,0.1); cursor: pointer; font-size: 0.85rem; border: 1px solid var(--border-color); color: var(--text-light); }
        .hisab-tab.active { background: var(--primary); color: #000; border-color: var(--primary); }
        .hisab-view { display: none; animation: fadeIn 0.3s; }
        .hisab-view.active { display: block; }
        .balance-hero { background: linear-gradient(135deg, #2563EB, #1D4ED8); color: white; text-align: center; padding: 25px; border-radius: 20px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(37, 99, 235, 0.4); }
        .balance-hero h1 { font-size: 2.2rem; margin: 5px 0; }
        .hisab-card { background: var(--component-bg); backdrop-filter: blur(12px); border: 1px solid var(--border-color); padding: 15px; border-radius: 16px; margin-bottom: 15px; position: relative; }
        .hisab-card.bank { border-left: 4px solid var(--bank-color); }
        .hisab-card.goal { border-left: 4px solid var(--goal-color); }
        .hisab-card.dps { border-left: 4px solid var(--dps-color); }
        .row-between { display: flex; justify-content: space-between; align-items: center; }
        .action-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .section-btn { flex: 1; padding: 10px; border-radius: 10px; border: none; font-weight: 600; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.9rem; }
        .btn-daily { background: var(--primary); color: #000; }
        .btn-bank { background: var(--bank-color); }
        .btn-goal { background: var(--goal-color); }
        .btn-dps { background: var(--dps-color); }
        .list-delete-btn, .card-delete-btn { color: var(--danger); cursor: pointer; background: rgba(230, 57, 70, 0.1); padding: 5px; border-radius: 5px; border: none; }

.card-delete-btn {
    display: none; 
}
        .pay-btn { padding: 4px 10px; border-radius: 5px; border: none; font-size: 0.75rem; background: var(--primary); color: #000; cursor: pointer; }

        /* CHATBOT */
        #chatbot-trigger { position: fixed; bottom: 90px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #00C6FF, #0072FF); border: none; color: white; font-size: 1.5rem; cursor: pointer; z-index: 2000; box-shadow: 0 0 20px rgba(0, 198, 255, 0.5); transition: transform 0.3s; display: none; }
        #chatbot-trigger:hover { transform: scale(1.1); }
        #chatbot-container { display: none; position: fixed; bottom: 100px; right: 20px; width: 320px; height: 450px; flex-direction: column; z-index: 2000; overflow: hidden; border: 1px solid rgba(255,255,255,0.2); }
        .chat-header { padding: 15px; background: rgba(0,0,0,0.4); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1); font-weight: bold; color: var(--primary); }
        #close-chat { background: none; border: none; color: white; cursor: pointer; }
        .chat-messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .message { max-width: 80%; padding: 10px; border-radius: 10px; font-size: 0.85rem; word-wrap: break-word; }
        .message.bot { align-self: flex-start; background: rgba(255,255,255,0.1); border-top-left-radius: 0; }
        .message.user { align-self: flex-end; background: var(--primary); color: #000; border-bottom-right-radius: 0; }
        .chat-input-area { padding: 10px; background: rgba(0,0,0,0.3); display: flex; gap: 5px; border-top: 1px solid rgba(255,255,255,0.1); }
        #chat-input { flex: 1; border-radius: 20px; font-size: 0.8rem; padding: 8px 12px; }
        #chat-send-btn, #chat-img-btn { background: var(--secondary); border: none; width: 35px; height: 35px; border-radius: 50%; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        #chat-img-btn { background: rgba(255,255,255,0.1); }
        .setting-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .setting-row:last-child { border-bottom: none; }
        .logic-tag { background: rgba(255,255,255,0.1); padding: 2px 8px; border-radius: 5px; font-size: 0.7rem; color: #aaa; margin-right: 5px; }

        /* THEME STORE STYLES */
        .theme-item { display: flex; justify-content: space-between; align-items: center; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border-color); padding: 12px; border-radius: 12px; margin-bottom: 10px; transition: 0.2s; }
        .theme-name { font-weight: 600; color: #fff; font-size: 0.95rem; }
        .theme-actions { display: flex; gap: 8px; align-items: center; }
        .btn-mini { border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; color: white; }
        .btn-download { background: linear-gradient(135deg, #00C6FF, #0072FF); }
        .btn-apply { background: #10B981; color: white; font-weight: 500; }
        .btn-delete { background: rgba(239, 68, 68, 0.2); color: #EF4444; border: 1px solid rgba(239, 68, 68, 0.3); }
        .badge-active { color: #10B981; font-weight: 700; font-size: 0.85rem; display: flex; align-items: center; gap: 5px; background: rgba(16, 185, 129, 0.1); padding: 5px 10px; border-radius: 6px; border: 1px solid rgba(16, 185, 129, 0.2); }

        /* DASHBOARD STYLES */
        .dashboard-wrapper { width: 100%; max-width: 100%; }
        .section-header { display: flex; align-items: center; gap: 10px; margin: 25px 0 15px 0; color: var(--text-light); opacity: 0.8; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1.5px; font-weight: 600; }
        .section-header::after { content: ''; flex: 1; height: 1px; background: rgba(255,255,255,0.1); }
        .finance-card { background: linear-gradient(135deg, #3b82f6 0%, #2dd4bf 100%); padding: 25px; border-radius: 20px; color: white; box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3); position: relative; margin-bottom: 20px; }
        .finance-top-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 5px; }
        .f-item h3 { font-size: 0.85rem; font-weight: 500; opacity: 0.9; margin-bottom: 5px; }
        .f-item h1 { font-size: 1.8rem; font-weight: 700; line-height: 1; margin: 0; }
        .text-right { text-align: right; }
        .finance-stats { display: flex; justify-content: space-between; margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2); }
        .mini-stat span { display: block; font-size: 0.75rem; opacity: 0.9; }
        .mini-stat b { font-size: 1.1rem; }
        .media-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .media-card { background: var(--component-bg); border: 1px solid var(--border-color); border-radius: 16px; padding: 15px; display: flex; align-items: center; gap: 15px; }
        .icon-box { width: 45px; height: 45px; border-radius: 12px; display: flex; justify-content: center; align-items: center; font-size: 1.2rem; }
        .bg-photo { background: rgba(236, 72, 153, 0.2); color: #f472b6; }
        .bg-video { background: rgba(168, 85, 247, 0.2); color: #c084fc; }
        .bg-audio { background: rgba(234, 179, 8, 0.2); color: #facc15; }
        .bg-file { background: rgba(34, 197, 94, 0.2); color: #4ade80; }
        .media-info h4 { font-size: 0.95rem; margin-bottom: 2px; }
        .media-info p { font-size: 0.75rem; color: #ccc; margin: 0; }
        .data-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;}
        .data-card { background: var(--component-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px 10px; text-align: center; }
        .data-card i { font-size: 1.2rem; margin-bottom: 8px; color: #60a5fa; }
        .data-card .num { display: block; font-size: 1.2rem; font-weight: 700; }
        .data-card .label { font-size: 0.7rem; color: #aaa; text-transform: uppercase; }
        .contact-bar { background: linear-gradient(90deg, rgba(30,41,59,0.8), rgba(15,23,42,0.8)); border: 1px solid var(--border-color); padding: 15px; border-radius: 16px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .c-left { display: flex; align-items: center; gap: 15px; }
        .c-icon { width: 40px; height: 40px; background: #3b82f6; color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; }
   /* --- Global Premium Input & Select Style (All Pages) --- */

/* ‡ßß. ‡¶∏‡¶¨ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü, ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü‡¶è‡¶∞‡¶ø‡ßü‡¶æ ‡¶¨‡ßú ‡¶ì ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡ßü‡¶æ‡¶Æ ‡¶ï‡¶∞‡¶æ */
input[type="text"], 
input[type="number"], 
input[type="email"], 
input[type="password"], 
input[type="tel"], 
input[type="url"], 
input[type="date"], 
select, 
textarea {
    width: 100% !important;
    height: 52px; /* ‡¶¨‡ßú ‡¶∏‡¶æ‡¶á‡¶ú */
    margin-bottom: 15px; /* ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶¶‡ßÇ‡¶∞‡¶§‡ßç‡¶¨ */
    padding: 0 18px;
    background: rgba(255, 255, 255, 0.05) !important; /* ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶ó‡ßç‡¶≤‡¶æ‡¶∏ ‡¶≤‡ßÅ‡¶ï */
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    border-radius: 12px !important;
    color: #fff !important;
    font-size: 0.95rem;
    font-family: 'Poppins', sans-serif;
    outline: none;
    box-sizing: border-box;
    transition: all 0.3s ease;
}

/* ‡ß®. ‡¶´‡ßã‡¶ï‡¶æ‡¶∏ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶ó‡ßç‡¶≤‡ßã ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü */
input:focus, select:focus, textarea:focus {
    border-color: var(--primary) !important;
    background: rgba(255, 255, 255, 0.1) !important;
    box-shadow: 0 0 15px rgba(33, 212, 253, 0.2);
}

/* ‡ß©. ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü‡¶è‡¶∞‡¶ø‡ßü‡¶æ (‡¶¨‡ßú ‡¶¨‡¶ï‡ßç‡¶∏) ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶π‡¶æ‡¶á‡¶ü */
textarea {
    height: auto !important;
    padding: 15px !important;
}

/* ‡ß™. ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶¨‡¶ï‡ßç‡¶∏ (Dropdown) ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Æ‡¶°‡¶æ‡¶∞‡ßç‡¶® ‡¶≤‡ßÅ‡¶ï */
select {
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E") !important;
    background-repeat: no-repeat !important;
    background-position: right 15px center !important;
    background-size: 16px !important;
}

/* ‡ß´. ‡¶™‡ßç‡¶≤‡ßá‡¶∏‡¶π‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ (‡¶ù‡¶æ‡¶™‡¶∏‡¶æ ‡¶∏‡¶æ‡¶¶‡¶æ) */
::placeholder {
    color: rgba(255, 255, 255, 0.3);
    font-size: 0.85rem;
    letter-spacing: 1px;
}

/* ‡ß¨. ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ (Add New Popup) ‡¶è‡¶∞ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶ï‡¶∞‡¶æ */
.modal-content {
    border-radius: 24px !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    padding: 25px !important;
}

.modal-content h3 {
    margin-bottom: 20px;
    letter-spacing: 1px;
    text-transform: uppercase;
    font-size: 1.1rem;
}

/* ‡ß≠. ‡¶∏‡ßá‡¶≠ ‡¶è‡¶¨‡¶Ç ‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶∏‡ßá‡¶≤ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
.modal-content .btn {
    height: 50px;
    border-radius: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 10px;
}
/* Savings Progress Bar Style */
.goal-progress-wrapper {
    width: 100%;
    margin-top: 12px;
}
.progress-bg {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    overflow: hidden;
}
.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #EA580C, #FB923C); /* ‡¶ó‡ßã‡¶≤ ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶ó‡ßç‡¶∞‡ßá‡¶°‡¶ø‡ßü‡ßá‡¶®‡ßç‡¶ü */
    border-radius: 10px;
    transition: width 0.5s ease-in-out;
}
.percent-text {
    font-size: 0.75rem;
    color: var(--goal-color);
    font-weight: 600;
    margin-bottom: 4px;
    display: block;
    text-align: right;
}
/* --- ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶∏‡ßã‡ßü‡¶æ‡¶á‡¶™ ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® (‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶ø‡¶§) --- */
.message {
    transition: transform 0.3s ease, opacity 0.3s ease;
    position: relative;
    user-select: none;
    -webkit-user-select: none;
    touch-action: pan-y; /* ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶â‡¶™‡¶∞‡ßá-‡¶®‡¶ø‡¶ö‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶π‡¶¨‡ßá ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶°‡¶æ‡¶®‡ßá-‡¶¨‡¶æ‡¶Æ‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶∏‡¶∞‡¶¨‡ßá */
}

/* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ (User) ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¨‡¶æ‡¶Æ‡ßá ‡¶∏‡ßã‡ßü‡¶æ‡¶á‡¶™ ‡¶π‡ßü‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡¶¨‡ßá */
.message.user.deleting {
    transform: translateX(-150%) !important;
    opacity: 0;
}

/* ‡¶¨‡¶ü‡ßá‡¶∞ (Bot) ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶°‡¶æ‡¶®‡ßá ‡¶∏‡ßã‡ßü‡¶æ‡¶á‡¶™ ‡¶π‡ßü‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡¶¨‡ßá */
.message.bot.deleting {
    transform: translateX(150%) !important;
    opacity: 0;
}
/* PIN ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶ó‡ßã‡¶™‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø */
.pin-hidden {
    -webkit-text-security: disc !important;
    text-security: disc !important;
}
/* Custom Confirm Box Style */
#custom-confirm-overlay {
    display: none;
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.7);
    z-index: 100000;
    backdrop-filter: blur(5px);
}
#custom-confirm-box {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(145deg, #171c2c, #0a0a14);
    border: 1px solid var(--primary);
    padding: 25px;
    border-radius: 20px;
    width: 85%; max-width: 320px;
    text-align: center;
    box-shadow: 0 0 30px rgba(0,0,0,0.5);
}
#custom-confirm-box p { color: #fff; margin-bottom: 25px; font-size: 1.1rem; }
.confirm-btns { display: flex; gap: 10px; }
.confirm-btn { flex: 1; padding: 12px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; }
.btn-no { background: rgba(255,255,255,0.1); color: #fff; }
.btn-yes { background: var(--danger); color: #fff; }


</style>
</head>
<body>
<!-- APP LOCK OVERLAY -->
<div id="app-lock-screen" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:20000; flex-direction:column; justify-content:center; align-items:center; backdrop-filter:blur(15px);">
    <div class="glass-ui" style="padding:30px; text-align:center; width:85%; max-width:350px; border:1px solid var(--primary);">
        <i class="fas fa-user-shield" style="font-size:3.5rem; color:var(--primary); margin-bottom:20px; text-shadow:0 0 15px var(--primary);"></i>
        <h2 id="lock-msg" style="margin-bottom:20px; font-size:1.2rem;">System Locked</h2>
        
        <input type="password" id="app-pin-input" placeholder="Enter PIN/Password" 
               style="text-align:center; font-size:1.2rem; letter-spacing:3px; margin-bottom:15px; border-color:var(--primary);">
        
        <button class="btn" onclick="unlockApp()" style="background:var(--primary); color:black; font-weight:bold;">UNLOCK <i class="fas fa-unlock"></i></button>
  
      <!-- ‡¶™‡¶ø‡¶® ‡¶á‡¶®‡¶™‡ßÅ‡¶ü‡ßá‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá ‡¶è‡¶á ‡¶¨‡¶æ‡¶ü‡¶®‡¶ü‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞ -->
<button onclick="forgotPinReset()" style="background:none; border:none; color:var(--primary); font-size:0.8rem; margin-top:10px; cursor:pointer; text-decoration:underline;">Forgot PIN/Password?</button>
      
  <div id="fingerprint-lock-section" style="margin-top:20px; display:none;">
            <p style="font-size:0.8rem; color:#888; margin-bottom:10px;">Or use Biometric</p>
            <button type="button" onclick="triggerLockFingerprint()" style="background:none; border:none; cursor:pointer;">
                <i class="fas fa-fingerprint" style="font-size:3rem; color:var(--primary);"></i>
            </button>
        </div>
    </div>
</div>
<!-- DYNAMIC THEME LAYER -->
<div id="theme-bg-layer" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; overflow: hidden;"></div>
<style id="theme-custom-style"></style>

    <!-- LOADING SCREEN -->
    <div id="loading-screen">
        <div class="tech-loader">
            <div class="tech-ring tr-1"></div>
            <div class="tech-ring tr-2"></div>
            <div class="tech-ring tr-dot"></div>
        </div>
        <div class="loading-text">SYSTEM LOADING...</div>
    </div>

    <div id="login-page">
        <div class="login-container glass-ui">
            <h2>Login Now</h2>
            <p id="login-error"></p>
            <form id="login-form">
                <div class="form-group"><label for="login-email">Email</label><input type="email" id="login-email" placeholder="Enter your email" required></div>
                
                <!-- PASSWORD INPUT WITH SHOW TOGGLE -->
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <div class="password-container">
                        <input type="password" id="login-password" placeholder="Enter your password" required>
                        <i class="fas fa-eye password-toggle" id="toggle-password-btn"></i>
                    </div>
                </div>
                <button type="submit" class="btn">Login</button>
             
                <!-- FINGERPRINT BUTTON START -->
                <div style="text-align: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                    <p id="fingerprint-text" style="font-size: 0.8rem; color: #999; margin-bottom: 10px; display: none;">Or unlock with</p>
                    <button type="button" id="fingerprint-btn" style="background: none; border: none; cursor: pointer; display: none;">
                        <i class="fas fa-fingerprint" style="font-size: 2.5rem; color: var(--primary);"></i>
                    </button>
                </div>
                <!-- FINGERPRINT BUTTON END -->
            </form>
        </div>
    </div>

    <div id="admin-panel">
        <!-- NEW TOPBAR WITH ABOUT BUTTON -->
        <div class="topbar glass-ui">
            <h2>All InfoZone </h2>
            <div class="top-actions">
                <button id="about-btn" class="about-toggle-btn" title="About"><i class="fas fa-info"></i></button>
                <button class="logout-btn" id="logout-button" title="Logout"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </div>

        <div class="content" id="content">
            <!-- Home Page -->
            <div id="dashboard-page" class="page-content active">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;"><h2>Dashboard</h2></div>
                <div class="dashboard-wrapper">
                    <!-- SECTION 1: FINANCE -->
                    <div class="section-header"><i class="fas fa-wallet"></i> <span>Overview</span></div>
                    <div class="finance-card">
                        <div class="finance-top-row">
                            <div class="f-item"><h3>Net Worth</h3><h1 id="dashboard-net-worth">‡ß≥ 0</h1></div>
                            <div class="f-item text-right"><h3>Total Info</h3><h1 id="dash-total-info">0</h1></div>
                        </div>
                        <div class="finance-stats">
                            <div class="mini-stat"><span>Cash</span><b id="dash-cash">0</b></div>
                            <div class="mini-stat"><span>Bank</span><b id="dash-bank">0</b></div>
                            <div class="mini-stat"><span>Savings (Goal+DPS)</span><b id="dash-savings">0</b></div>
                        </div>
                    </div>
                    <!-- SECTION 2: MEDIA LIBRARY -->
                    <div class="section-header"><i class="fas fa-folder-open"></i> <span>Media Library</span></div>
                    <div class="media-grid">
                        <div class="media-card"><div class="icon-box bg-photo"><i class="fas fa-image"></i></div><div class="media-info"><h4>Photos</h4><p><span id="count-photo">0</span> items</p></div></div>
                        <div class="media-card"><div class="icon-box bg-video"><i class="fas fa-video"></i></div><div class="media-info"><h4>Videos</h4><p><span id="count-video">0</span> items</p></div></div>
                        <div class="media-card"><div class="icon-box bg-audio"><i class="fas fa-music"></i></div><div class="media-info"><h4>Audio</h4><p><span id="count-audio">0</span> items</p></div></div>
                        <div class="media-card"><div class="icon-box bg-file"><i class="fas fa-file-alt"></i></div><div class="media-info"><h4>Files</h4><p><span id="count-file">0</span> docs</p></div></div>
                    </div>
                    <!-- SECTION 3: DATA & INFO -->
                    <div class="section-header"><i class="fas fa-database"></i> <span>Data Details</span></div>
                    <div class="data-grid">
                        <div class="data-card"><i class="fas fa-align-left"></i><span class="num" id="count-text">0</span><span class="label">Text Info</span></div>
                        <div class="data-card"><i class="fas fa-link"></i><span class="num" id="count-link">0</span><span class="label">Links</span></div>
                        <div class="data-card"><i class="fas fa-envelope"></i><span class="num" id="count-mail">0</span><span class="label">Mails</span></div>
                    </div>
                    <!-- SECTION 4: CONTACTS -->
                    <div class="section-header"><i class="fas fa-users"></i> <span>People</span></div>
                    <div class="contact-bar">
                        <div class="c-left"><div class="c-icon"><i class="fas fa-address-book"></i></div><div><h4 style="margin:0; font-weight:600;">All Contacts</h4><small style="color:#94a3b8;">Saved numbers</small></div></div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #3b82f6;" id="count-contacts">0</div>
                    </div>
                    <!-- Recent Tables -->
                    <h3 style="margin-top: 1.5rem; font-size:1rem;">Recent Contacts</h3>
                    <div class="glass-ui" style="overflow-x: auto; margin-bottom: 20px;">
                        <table class="info-table"><thead><tr><th>Name</th><th>Phone</th><th>Actions</th></tr></thead><tbody id="recent-contacts-table"></tbody></table>
                    </div>
                    <h3 style="font-size:1rem;">Recent Information</h3>
                    <div class="glass-ui" style="overflow-x: auto;">
                        <table class="info-table"><thead><tr><th>UID</th><th>Title</th><th>Actions</th></tr></thead><tbody id="recent-info-table"></tbody></table>
                    </div>
                </div>
            </div>

            <!-- Search Page -->
            <div id="search-page" class="page-content">
                <h2>Search Information</h2>
                <div class="glass-ui" style="padding: 1.5rem;">
                    <div class="search-controls">
                        <select id="search-category" class="btn">
                            <option value="all">All</option>
                            <option value="text">Text Info</option>
                            <option value="link">Link Info</option>
                            <option value="mail">Mail Info</option>
                            <option value="contacts">Contacts</option>
                            <option value="photo">Photo</option>
                            <option value="video">Video</option>
                            <option value="audio">Music/Audio</option>
                            <option value="file">File (PDF/Docs)</option>
                        </select>
                        <input type="text" id="search-keyword" placeholder="Search by UID, Title, Name...">
                        <button class="btn" id="search-button"><i class="fas fa-search"></i> Search</button>
                    </div>
                    <div id="search-results" style="overflow-x: auto;">
                        <table class="info-table"><thead id="search-results-thead"></thead><tbody id="search-results-tbody"></tbody></table>
                    </div>
                </div>
            </div>

            <!-- Add Info Page -->
            <div id="add-info-page" class="page-content">
                <h2>Add New Information</h2>
                <div class="glass-ui" style="padding: 1.5rem;">
                    <div class="form-group">
                        <label>Category</label>
                        <select id="info-category" required>
                            <option value="">Select Category</option>
                            <option value="text">Text Info</option>
                            <option value="link">Link Info</option>
                            <option value="mail">Mail Info</option>
                            <option value="photo">Photo / Image</option>
                            <option value="video">Video Info</option>
                            <option value="audio">Music / Audio</option>
                            <option value="file">File (PDF/Docs)</option>
                        </select>
                    </div>
                    <label class="toggle-label" id="mail-bulk-toggle-wrapper" style="display: none;"><input type="checkbox" id="mail-bulk-toggle"><span><i class="fas fa-layer-group"></i> Bulk Import Mode</span></label>
                    <form id="add-info-form">
                        <div class="form-group"><label>Title</label><input type="text" id="info-title" placeholder="Enter title" required></div>
                        <div class="form-group" id="text-upload-group"><button type="button" class="btn ai-btn" id="ai-scan-info-btn"><i class="fas fa-magic"></i> AI Scan Image to Text</button><label>Text Content</label><textarea id="info-content" placeholder="Enter text or use AI Scan..."></textarea></div>
                        <div class="form-group" id="link-upload-group" style="display: none;"><label>Website/Link</label><input type="url" id="info-link" placeholder="https://example.com"></div>
                        <div class="form-group" id="file-upload-group" style="display: none;"><label id="file-label">Upload File (Telegram Storage)</label><input type="file" id="info-file-input" style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; width: 100%;"><div id="upload-status" style="margin-top:5px; font-size:0.8rem; color: var(--secondary);"></div></div>
                        <div class="form-group" id="mail-bulk-mode" style="display: none;"><button type="button" class="btn ai-btn" id="ai-scan-mail-btn"><i class="fas fa-magic"></i> AI Scan Mail List</button><label>Bulk Import List</label><textarea id="bulk-mail-text" placeholder="Paste your list here..." style="height: 120px;"></textarea><button type="button" class="btn process-btn" id="process-mail-btn">Direct Now <i class="fas fa-arrow-down"></i></button></div>
                        <div class="form-group" id="mail-manual-mode" style="display: none;"><label>Mail Credentials</label><div id="mail-rows-container"><div class="mail-input-group"><input type="email" class="mail-email" placeholder="Email"><input type="text" class="mail-password" placeholder="Pass"><button type="button" class="add-mail-btn btn">+</button></div></div></div>
                        <button type="submit" class="btn">Add Information</button>
                    </form>
                </div>
            </div>

            <!-- All Category Info Page -->
            <div id="all-category-info-page" class="page-content">
                <h2>All Category Information</h2>
                <div class="category-filters">
                    <button class="btn filter-btn active" data-category="all">All</button>
                    <button class="btn filter-btn" data-category="text">Text</button>
                    <button class="btn filter-btn" data-category="link">Link</button>
                    <button class="btn filter-btn" data-category="mail">Mail</button>
                    <button class="btn filter-btn" data-category="photo">Photo</button>
                    <button class="btn filter-btn" data-category="video">Video</button>
                    <button class="btn filter-btn" data-category="file">File</button>
                </div>
                 <div class="glass-ui" style="overflow-x: auto;">
                    <table class="info-table"><thead><tr><th>UID</th><th>Title</th><th>Category</th><th>Actions</th></tr></thead><tbody id="all-info-table"></tbody></table>
                </div>
            </div>

            <!-- Add Contact Page -->
            <div id="add-contact-page" class="page-content">
                <h2>Add New Contact</h2>
                <div class="glass-ui" style="padding: 1.5rem;">
                    <label class="toggle-label"><input type="checkbox" id="contact-bulk-toggle"><span><i class="fas fa-layer-group"></i> Bulk Import Mode</span></label>
                    <form id="add-contact-form">
                        <div id="single-contact-mode">
                            <div class="form-group"><label>Name</label><input type="text" id="contact-name" placeholder="Enter full name"></div>
                            <div class="form-group"><label>Phone(s)</label><div id="phone-numbers-container"><div class="phone-input-group"><input type="tel" class="contact-phone" placeholder="Phone"><button type="button" class="add-phone-btn btn">+</button></div></div></div>
                            <div class="form-group"><label>Email</label><input type="email" id="contact-email" placeholder="Email"></div>
                            <div class="form-group"><label>Address</label><textarea id="contact-address" placeholder="Address"></textarea></div>
                            <div class="form-group"><label>Social Link(s)</label><div id="social-links-container"><div class="social-input-group"><input type="url" class="contact-social" placeholder="Link"><button type="button" class="add-social-btn btn">+</button></div></div></div>
                        </div>
                        <div id="bulk-contact-mode" style="display: none;">
                            <div class="form-group"><button type="button" class="btn ai-btn" id="ai-scan-contact-btn"><i class="fas fa-magic"></i> AI Scan List Image</button><label>Paste List</label><textarea id="bulk-contact-text" placeholder="Paste data here..." style="height: 150px;"></textarea><button type="button" class="btn process-btn" id="process-contact-btn">Direct Now <i class="fas fa-arrow-down"></i></button></div>
                            <div id="bulk-contact-preview"></div>
                        </div>
                        <button type="submit" class="btn" id="contact-submit-btn">Add Contact</button>
                    </form>
                </div>
            </div>

            <!-- All Contacts Page -->
            <div id="all-contacts-page" class="page-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h2>All Contacts</h2>
                    <button class="open-btn" onclick="openAddContactPage()" style="background: var(--primary); color: black;">+ Add New</button>
                </div>
                 <div class="glass-ui" style="overflow-x: auto;">
                    <table class="info-table"><thead><tr><th>Name</th><th>Address</th><th>Actions</th></tr></thead><tbody id="all-contacts-table"></tbody></table>
                </div>
            </div>

            <!-- ================= HISAB TRACKER PAGE ================= -->
            <div id="hisab-page" class="page-content">
                <h2>Amar Hisab</h2>
                <div class="hisab-tabs">
                    <div class="hisab-tab active" onclick="switchHisabTab('home')">Home</div>
                    <div class="hisab-tab" onclick="switchHisabTab('daily')">Daily</div>
                    <div class="hisab-tab" onclick="switchHisabTab('bank')">Bank</div>
                    <div class="hisab-tab" onclick="switchHisabTab('goal')">Goal</div>
                    <div class="hisab-tab" onclick="switchHisabTab('dps')">DPS</div>
                </div>
                <!-- 1. Home View -->
                <div id="hisab-view-home" class="hisab-view active">
                    <div class="balance-hero"><p>Total Net Worth</p><h1 id="net-worth">‡ß≥ 0</h1><p style="font-size: 0.8rem; opacity: 0.9;">(Cash + Bank + Goal + DPS)</p></div>
                    <div class="glass-ui" style="padding: 1.5rem;">
                        <h3 style="margin-bottom: 15px;">Summary</h3>
                        <div class="row-between" style="margin-top:10px"><span>ü§ö Cash Balance</span><b id="sum-cash">‡ß≥ 0</b></div>
                        <div class="row-between" style="margin-top:10px"><span>üè¶ Bank Balance</span><b id="sum-bank" style="color: #818cf8;">‡ß≥ 0</b></div>
                        <div class="row-between" style="margin-top:10px"><span>üéØ Goal Savings</span><b id="sum-goal" style="color: #fb923c;">‡ß≥ 0</b></div>
                        <div class="row-between" style="margin-top:10px"><span>üü£ DPS Saved</span><b id="sum-dps" style="color: #a78bfa;">‡ß≥ 0</b></div>
                    </div>
                </div>
                <!-- 2. Daily View -->
                <div id="hisab-view-daily" class="hisab-view">
                    <div class="action-row"><button class="section-btn btn-daily" onclick="openHisabModal('daily_entry')"><i class="fas fa-plus-circle"></i> Add Entry</button></div>
                    <div id="daily-list"></div>
                </div>
                <!-- 3. Bank View -->
                <div id="hisab-view-bank" class="hisab-view">
                    <div class="action-row"><button class="section-btn btn-bank" onclick="openHisabModal('new_bank')"><i class="fas fa-university"></i> New A/C</button></div>
                    <div id="bank-list"></div>
                </div>
                <!-- 4. Goal View -->
                <div id="hisab-view-goal" class="hisab-view">
                    <div class="action-row"><button class="section-btn btn-goal" onclick="openHisabModal('new_goal')"><i class="fas fa-bullseye"></i> New Goal</button></div>
                    <div id="goal-list"></div>
                </div>
                <!-- 5. DPS View -->
                <div id="hisab-view-dps" class="hisab-view">
                    <div class="action-row"><button class="section-btn btn-dps" onclick="openHisabModal('new_dps')"><i class="fas fa-piggy-bank"></i> New DPS</button></div>
                    <div id="dps-list"></div>
                </div>
            </div>
        </div>
        
        <nav class="bottom-nav glass-ui">
            <a href="#" class="active" data-page="dashboard"><i class="fas fa-home"></i><span>Home</span></a>
            <a href="#" data-page="search"><i class="fas fa-search"></i><span>Search</span></a>
            <a href="#" data-page="hisab"><i class="fas fa-calculator"></i><span>Hisab</span></a>
            <a href="#" data-page="add-contact"><i class="fas fa-user-plus"></i><span>Add Cont.</span></a>
            <a href="#" data-page="add-info"><i class="fas fa-plus-circle"></i><span>Add Info</span></a>
            <a href="#" data-page="all-category-info"><i class="fas fa-list"></i><span>Info List</span></a>
            <a href="#" data-page="all-contacts"><i class="fas fa-address-book"></i><span>Contacts</span></a>
        </nav>
    </div>
    
    <div class="modal" id="info-modal">
        <div class="modal-content glass-ui">
             <div class="modal-header" id="info-modal-header"></div>
             <div class="modal-body" id="info-modal-body" style="margin: 1.5rem 0; max-height: 60vh; overflow-y: auto;"></div>
             <div id="info-modal-footer"></div>
             <button class="btn" id="close-info-modal" style="margin-top:10px">Close</button>
        </div>
    </div>

    <div class="modal" id="hisab-modal">
        <div class="modal-content glass-ui">
            <h3 id="hisab-modal-title" style="margin-bottom: 15px; color: var(--primary);">Add New</h3>
            <input type="hidden" id="hisab-modal-context">
            <div id="hisab-modal-inputs"></div>
            <button class="btn" style="margin-top: 15px;" onclick="submitHisabData()">Save</button>
            <button class="btn" style="background:none; border:none; margin-top:5px; color: #ccc;" onclick="document.getElementById('hisab-modal').style.display='none'">Cancel</button>
        </div>
    </div>
    
    <!-- ABOUT MODAL -->
    <div class="modal" id="about-modal" style="z-index: 5000;">
        <div class="modal-content glass-ui" style="text-align: center; position: relative; overflow: hidden; max-width: 380px;">
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, #21D4FD, #B721FF, #f72585);"></div>
            <button onclick="document.getElementById('about-modal').style.display='none'" style="position: absolute; top: 10px; right: 15px; background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">&times;</button>
            <h1 style="color: var(--primary); font-size: 26px; font-weight: 800; margin-top: 15px; margin-bottom: 5px;">All Info Zone</h1>
            <div style="background: rgba(33, 212, 253, 0.15); color: var(--primary); padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; display: inline-block; margin-bottom: 20px; border: 1px solid var(--primary);">v5.1.0</div>
            <p style="color: #ccc; font-size: 14px; line-height: 1.5; margin-bottom: 25px; padding: 0 10px;">I personally developed this app to keep important information in one place easily and quickly.</p>
            <div style="background: rgba(255, 255, 255, 0.05); border: 1px dashed var(--border-color); padding: 10px; border-radius: 10px; font-size: 13px; color: #aaa; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                <i class="fa-solid fa-code" style="color: var(--secondary);"></i><span>Developer: <strong style="color: white;">Me</strong> (Personal Project)</span>
            </div>
            <div style="background: linear-gradient(to right, rgba(255,255,255,0.05), rgba(255,255,255,0.02)); border-left: 4px solid var(--primary); padding: 12px 15px; border-radius: 8px; margin-bottom: 30px; text-align: left;">
                <span style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 700; display: block; margin-bottom: 4px;">Logged in as</span>
                <div style="font-size: 14px; color: white; font-weight: 600; display: flex; align-items: center; gap: 8px; word-break: break-all;">
                    <i class="fa-solid fa-circle-user" style="color: var(--primary);"></i><span id="about-user-email">guest@example.com</span>
                </div>
            </div>
            <div style="display: flex; flex-direction: column; gap: 12px;">
                <a href="https://www.facebook.com/piyashhasan.ph" target="_blank" style="text-decoration: none;"><button class="btn" style="background: linear-gradient(135deg, #1877F2, #104996); border: none; display: flex; align-items: center; justify-content: space-between; padding: 12px 20px;"><span style="display: flex; align-items: center; gap: 10px;"><i class="fab fa-facebook-f"></i> Facebook</span><i class="fas fa-chevron-right" style="font-size: 10px; opacity: 0.6;"></i></button></a>
                <a href="https://wa.me/+8801325428923" target="_blank" style="text-decoration: none;"><button class="btn" style="background: linear-gradient(135deg, #25D366, #0e5e54); border: none; display: flex; align-items: center; justify-content: space-between; padding: 12px 20px;"><span style="display: flex; align-items: center; gap: 10px;"><i class="fab fa-whatsapp"></i> WhatsApp</span><i class="fas fa-chevron-right" style="font-size: 10px; opacity: 0.6;"></i></button></a>
                <a href="https://t.me/piyashhasan_ph564" target="_blank" style="text-decoration: none;"><button class="btn" style="background: linear-gradient(135deg, #2AABEE, #187db3); border: none; display: flex; align-items: center; justify-content: space-between; padding: 12px 20px;"><span style="display: flex; align-items: center; gap: 10px;"><i class="fab fa-telegram-plane"></i> Telegram</span><i class="fas fa-chevron-right" style="font-size: 10px; opacity: 0.6;"></i></button></a>
            </div>
            <div style="margin-top: 30px; font-size: 12px; color: #666;">&copy; 2025 All Info Zone.</div>
        </div>
    </div>
    
    <div class="modal" id="update-modal" style="z-index: 3000; display: none !important;">
        <div class="modal-content glass-ui" style="text-align: center;">
            <i class="fas fa-rocket" style="font-size: 3rem; color: var(--secondary); margin-bottom: 15px;"></i>
            <h2 style="color: var(--primary);">Update Available!</h2>
            <p id="update-msg" style="margin: 10px 0; color: #ccc;">A new version of the app is available.</p>
            <p style="font-size: 0.8rem; color: gray;">Version: <span id="new-version-display"></span></p>
            <a id="update-link" href="#" target="_blank" style="text-decoration: none;"><button class="btn" style="background: var(--success); color: #000; margin-top: 15px;">Download Now <i class="fas fa-download"></i></button></a>
            <button class="btn" style="background: none; border: 1px solid var(--danger); margin-top: 10px; font-size: 0.8rem;" onclick="document.getElementById('update-modal').style.display='none'">Remind Me Later</button>
        </div>
    </div>
        <!-- TRAINING MODAL -->
    <div class="modal" id="training-modal" style="z-index: 4000;">
        <div class="modal-content glass-ui">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.2); padding-bottom:10px;">
                <h3 style="color:var(--secondary); margin:0;"><i class="fas fa-brain"></i> AI Brain (Personal)</h3>
                <div>
                    <button class="btn" onclick="switchTrainView('form')" style="width:auto; padding:5px 10px; display:inline-block;" title="Add New"><i class="fas fa-plus"></i></button>
                    <button class="btn" onclick="switchTrainView('list')" style="width:auto; padding:5px 10px; display:inline-block; background:var(--primary); color:black;" title="History"><i class="fas fa-history"></i></button>
                    <button onclick="document.getElementById('training-modal').style.display='none'" style="background:none; border:none; color:white; font-size:1.2rem; margin-left:10px; cursor:pointer;">&times;</button>
                </div>
            </div>
            
            <div id="train-view-form">
                <input type="hidden" id="edit-train-id">
                <div class="form-group"><label>When I say... (Keyword)</label><input type="text" id="train-q" placeholder="e.g. kemon acho"></div>
                <div class="form-group"><label>Bot replies...</label><textarea id="train-a" placeholder="e.g. Ami valo achi boss" rows="3"></textarea></div>
                <button class="btn" onclick="saveTraining()" id="train-save-btn">Save Lesson</button>
            </div>
            <div id="train-view-list" style="display:none;">
                <input type="text" id="train-search" placeholder="Search history..." onkeyup="filterTraining()" style="margin-bottom:10px; padding:10px; width:100%; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.2); border-radius:8px; color:white;">
                <div id="training-list-container" style="max-height: 250px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>
    <!-- MODERN PIN RESET MODAL -->
<div class="modal" id="pin-reset-modal" style="z-index: 25000;">
    <div class="modal-content glass-ui" style="text-align: center; max-width: 350px; border: 1px solid var(--primary);">
        <i class="fas fa-user-lock" style="font-size: 3rem; color: var(--primary); margin-bottom: 20px; text-shadow: 0 0 15px var(--primary);"></i>
        <h3 style="color: white; margin-bottom: 10px;">Security Check</h3>
        <p style="font-size: 0.85rem; color: #ccc; margin-bottom: 20px;">Reset PIN lock with your main login password:</p>
        
        <input type="password" id="master-pass-input" placeholder="Enter Login Password" 
               style="text-align: center; border-color: var(--primary); background: rgba(0,0,0,0.3); margin-bottom: 15px;">
        
        <div style="display: flex; gap: 10px;">
            <button class="btn" onclick="executePinReset()" style="background: var(--primary); color: black; flex: 1; font-weight: bold;">RESET PIN</button>
            <button class="btn" onclick="document.getElementById('pin-reset-modal').style.display='none'" style="background: rgba(255,255,255,0.1); flex: 1;">CANCEL</button>
        </div>
        <div id="reset-error-msg" style="color: var(--danger); font-size: 0.8rem; margin-top: 10px;"></div>
    </div>
</div>
 <!-- MODERN SHARE PASSWORD MODAL (Lines 471+) -->
<div class="modal" id="share-pass-modal" style="z-index: 26000;">
    <div class="modal-content glass-ui" style="text-align: center; max-width: 380px; border: 1px solid var(--primary); position: relative;">
        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, var(--primary), var(--secondary));"></div>
        <i class="fas fa-share-nodes" style="font-size: 2.8rem; color: var(--primary); margin-bottom: 20px; text-shadow: 0 0 15px var(--primary);"></i>
        <h3 style="color: white; margin-bottom: 10px;">Secure Sharing</h3>
        <p style="font-size: 0.85rem; color: #aaa; margin-bottom: 20px;">‡¶è‡¶á ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶®‡¶ø‡¶ö‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï):</p>
        <input type="text" id="set-share-password" placeholder="Password (Optional)" 
               style="text-align: center; border-color: var(--primary); background: rgba(0,0,0,0.3); margin-bottom: 20px;">
        <div style="display: flex; gap: 10px;">
            <button class="btn" id="final-share-btn" style="background: var(--primary); color: black; flex: 1; font-weight: bold;">GENERATE LINK</button>
            <button class="btn" onclick="document.getElementById('share-pass-modal').style.display='none'" style="background: rgba(255,255,255,0.1); flex: 1;">CANCEL</button>
        </div>
    </div>
</div>

    <!-- NEW SETTINGS MODAL -->
    <div class="modal" id="settings-modal" style="z-index: 4500;">
        <div class="modal-content glass-ui">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.2); padding-bottom:10px;">
                <h3 style="color:var(--primary); margin:0;"><i class="fas fa-cogs"></i> Command Settings</h3>
                <button onclick="document.getElementById('settings-modal').style.display='none'" style="background:none; border:none; color:white; font-size:1.2rem; cursor:pointer;">&times;</button>
            </div>
            
            <!-- ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
<div style="margin-bottom: 15px;">
    <h4 style="color:var(--primary); margin-bottom: 10px;"><i class="fas fa-terminal"></i> Custom Commands</h4>
    <p style="font-size:0.8rem; color:#ccc;">‡¶¨‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶ø‡¶ú‡¶∏‡ßç‡¶¨ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®:</p>
    <div class="form-group" style="margin-top:10px;">
        <label>Select Logic</label>
        <select id="setting-logic-select">
            <option value="">-- Choose Logic --</option>
            <option value="ADD_INCOME">1. Income Add (+)</option>
            <option value="ADD_EXPENSE">2. Expense Add (-)</option>
            <option value="VIEW_BALANCE">3. View Total Balance</option>
            <option value="VIEW_HISTORY">4. View History</option>
            <option value="NEW_BANK">5. New Bank A/C</option>
            <option value="DEPOSIT_BANK">6. Deposit to Bank</option>
            <option value="WITHDRAW_BANK">7. Withdraw from Bank</option>
            <option value="BANK_LIST">8. Bank List</option>
            <option value="NEW_GOAL">9. New Goal</option>
            <option value="SAVE_GOAL">10. Save to Goal</option>
            <option value="GOAL_LIST">11. Goal List</option>
            <option value="NEW_DPS">12. New DPS</option>
            <option value="PAY_DPS">13. Pay DPS Monthly</option>
            <option value="DPS_LIST">14. DPS List</option>
            <option value="ADD_CONTACT">15. Add Contact</option>
            <option value="SEARCH_CONTACT">16. Search Contact</option>
            <option value="ADD_LINK">17. Add Link Info</option>
            <option value="ADD_INFO">18. Add Text Info</option>
            <option value="SEARCH_ALL">19. General Search</option>
            <option value="TRAIN_ON">20. Open Training (Silent)</option>
            <option value="OPEN_SETTINGS">21. Open Settings (Silent)</option>
            <option value="ADD_PHOTO">22. Add/Upload Photo</option>
            <option value="ADD_VIDEO">23. Add/Upload Video</option>
            <option value="ADD_AUDIO">24. Add/Upload Audio</option>
            <option value="ADD_FILE">25. Add/Upload File</option>
        </select>
    </div>
    <div class="form-group">
        <label>Your Custom Command</label>
        <input type="text" id="setting-custom-cmd" placeholder="e.g. taka aslo">
    </div>
    <button class="btn" onclick="saveCommandSetting()">Set Command</button>
</div>

<h4 style="margin-top:20px; border-top:1px solid rgba(255,255,255,0.1); padding-top:10px;">Active Commands</h4>
<div id="settings-list-container" style="max-height: 200px; overflow-y: auto; margin-top: 10px;"></div>
            
            <!-- LOCK SETTINGS INSIDE COMMAND SETTINGS -->
<div class="form-group" style="border-top:1px solid rgba(255,255,255,0.1); margin-top:20px; padding-top:15px;">
    <h4 style="color:var(--secondary); margin-bottom:10px;"><i class="fas fa-key"></i> Security Settings</h4>
    
    <label style="font-size:0.8rem;">Select Lock Type</label>
    <select id="lock-type-select" style="margin-bottom: 10px;" onchange="updateLockPlaceholder()">
        <option value="pin">Numeric PIN (4-11 Digits)</option>
        <option value="pass">Password (6-11 Chars)</option>
    </select>

    <label style="font-size:0.8rem;">Set New Value</label>
    <input type="password" id="new-app-lock" placeholder="Enter PIN (Digits only)">
    
    <div style="display:flex; gap:10px; margin-top:5px;">
        <button class="btn" onclick="saveAppLockSettings()" style="background:var(--success); flex:1;">Save Lock</button>
        <button class="btn" id="toggle-biometric-btn" onclick="toggleBiometric()" style="background:#444; flex:1; font-size:0.7rem;">Fingerprint: OFF</button>
    </div>
</div>

            <!-- THEME STORE SECTION IN SETTINGS -->
            <div class="form-group" style="border-top: 1px solid rgba(255,255,255,0.1); margin-top: 20px; padding-top: 10px;">
                <h4 style="color: var(--primary); margin-bottom: 10px;"><i class="fas fa-layer-group"></i> My Theme Store</h4>
                <input type="file" id="theme-upload-input" accept=".html,.txt" style="display: none;">
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="btn" onclick="document.getElementById('theme-upload-input').click()" style="background: linear-gradient(90deg, #00C6FF, #0072FF); flex: 1;">
                        <i class="fas fa-plus-circle"></i> Import New Theme
                    </button>
                    <button class="btn" onclick="resetToDefaultTheme()" style="background: #333; flex: 1;">
                        <i class="fas fa-undo"></i> Use Default
                    </button>
                </div>
                <p style="font-size: 0.8rem; color: #aaa; margin-bottom: 5px;">Saved Themes:</p>
                <div id="theme-store-list" style="max-height: 150px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; border: 1px solid rgba(255,255,255,0.1); padding: 5px; border-radius: 8px;"></div>
            </div>
        </div>
    </div>
    <!-- API SETTINGS MODAL -->
<div class="modal" id="api-settings-modal" style="z-index: 7000;">
    <div class="modal-content glass-ui">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.2); padding-bottom:10px;">
            <h3 style="color:var(--primary); margin:0;"><i class="fas fa-server"></i> API Configuration</h3>
            <button onclick="document.getElementById('api-settings-modal').style.display='none'" style="background:none; border:none; color:white; font-size:1.2rem; cursor:pointer;">&times;</button>
        </div>
        
        <div id="api-view-mode">
            <p style="font-size:0.8rem; color:#aaa;">Current Telegram Settings:</p>
            <div style="background:rgba(0,0,0,0.2); padding:10px; border-radius:8px; margin-bottom:15px;">
                <small>Token:</small> <div id="display-bot-token" style="word-break:break-all; color:var(--secondary);">Loading...</div>
                <small>Chat ID:</small> <div id="display-chat-id" style="color:var(--success);">Loading...</div>
            </div>
            <button class="btn" onclick="requestAuthForApi()"><i class="fas fa-edit"></i> Edit API Info</button>
        </div>

        <div id="api-edit-mode" style="display: none;">
            <div class="form-group">
                <label>Telegram Bot Token</label>
                <input type="text" id="new-bot-token" placeholder="Enter Token">
            </div>
            <div class="form-group">
                <label>Telegram Chat ID</label>
                <input type="text" id="new-chat-id" placeholder="Enter Chat ID">
            </div>
            <button class="btn" onclick="saveApiSettings()" style="background:var(--success);">Update & Save</button>
            <button class="btn" onclick="closeApiEdit()" style="background:none; border:none; color:#ccc;">Cancel</button>
        </div>
    </div>
</div>
<!-- ‡¶Æ‡¶°‡¶æ‡¶∞‡ßç‡¶® ‡¶è‡¶™‡¶ø‡¶Ü‡¶á ‡¶™‡¶ø‡¶® ‡¶¨‡¶ï‡ßç‡¶∏ -->
<div class="modal" id="api-auth-modal" style="z-index: 8000;">
    <div class="modal-content glass-ui" style="text-align: center; max-width: 350px;">
        <i class="fas fa-shield-alt" style="font-size: 2.5rem; color: var(--primary); margin-bottom: 15px;"></i>
        <h3 style="color: white; margin-bottom: 10px;">Security Check</h3>
        <p style="font-size: 0.85rem; color: #ccc; margin-bottom: 20px;">Enter PIN to change API:</p>
        
        <input type="password" id="api-auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
       inputmode="numeric" 
       pattern="[0-9]*"
       style="text-align: center; font-size: 1.5rem; letter-spacing: 5px; background: rgba(0,0,0,0.3);">
        
        <div style="display: flex; gap: 10px; margin-top: 10px;">
            <button class="btn" onclick="verifyApiAuth()" style="background: var(--primary); color: black; flex: 1; font-weight: bold;">OK</button>
            <button class="btn" onclick="document.getElementById('api-auth-modal').style.display='none'" style="background: rgba(255,255,255,0.1); flex: 1;">CANCEL</button>
        </div>
    </div>
</div>
<!-- MOANA TOOLS MODAL (Fixed Box Visibility) -->
<div class="modal" id="moana-tools-modal" style="z-index: 6000; display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); justify-content: center; align-items: center;">
    <div class="modal-content" style="background: #ffffff; color: #333; border: 4px solid #f4d03f; border-radius: 25px; max-width: 480px; width: 92%; padding: 25px; position: relative; box-shadow: 0 15px 35px rgba(0,0,0,0.4);">
        
        <!-- Close Button -->
        <button onclick="document.getElementById('moana-tools-modal').style.display='none'" style="position:absolute; top:15px; right:20px; background:none; border:none; color:#333; font-size:1.8rem; cursor:pointer;">&times;</button>

        <!-- Tab Menu -->
        <div style="display: flex; background: #e0f7fa; padding: 5px; border-radius: 50px; margin-bottom: 25px; border: 2px solid #0077be;">
            <button id="moana-tab-1" class="tab-btn active" onclick="switchMoanaTab('word')" style="flex:1; border-radius: 50px; border:none; padding:12px; cursor:pointer; font-weight:bold; background:#0077be; color:white; transition: 0.3s;">Word Count</button>
            <button id="moana-tab-2" class="tab-btn" onclick="switchMoanaTab('email')" style="flex:1; border-radius: 50px; border:none; padding:12px; cursor:pointer; font-weight:bold; background:none; color:#005662; transition: 0.3s;">Email Tools</button>
        </div>

        <!-- 1. Word Counter Section -->
        <div id="moana-word-sec">
            <h2 style="color: #0077be; margin-bottom: 15px; font-size: 22px;">üåä Word Counter</h2>
            
            <label style="display:block; font-size:14px; font-weight:bold; margin-bottom:5px; color:#1d2b64;">Input Text:</label>
            <textarea id="moana-text-input" rows="6" placeholder="Paste or type your text here..." 
                style="width: 100%; padding: 15px; border: 2px solid #0077be !important; border-radius: 15px; background: #f0faff !important; color: #000 !important; font-size: 15px; outline: none; margin-bottom: 15px; box-sizing: border-box; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); height: 150px !important;"></textarea>
            
            <div style="display:flex; justify-content:space-around; background:#e0f2f1; padding:15px; border-radius:15px; margin-bottom:15px; border: 2px solid #b2ebf2;">
                <div style="text-align:center;"><b id="m-word-count" style="color:#0077be; font-size:24px; display:block;">0</b><span style="font-size:12px; color:#555; font-weight:bold;">WORDS</span></div>
                <div style="text-align:center;"><b id="m-char-count" style="color:#0077be; font-size:24px; display:block;">0</b><span style="font-size:12px; color:#555; font-weight:bold;">CHARS</span></div>
            </div>
            
            <button class="btn" style="background:#ff6b6b; color:white; border:none; width:100%; padding: 14px; border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; box-shadow: 0 4px 10px rgba(255,107,107,0.3);" onclick="clearMoanaText()">Clear All Text</button>
        </div>

        <!-- 2. Email Tools Section -->
        <div id="moana-email-sec" style="display:none;">
            <h2 style="color: #0077be; margin-bottom: 15px; font-size: 22px;">üå¥ Email Scanner & Joiner</h2>
            
            <div style="background: #fff9c4; padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 2px solid #fbc02d;">
                <label style="display:block; font-size:13px; font-weight:bold; margin-bottom:8px; color:#333;">üì∑ Extract Emails from Image:</label>
                <input type="file" id="moana-img-input" accept="image/*" onchange="moanaScanImage()" style="width:100%; background: #fff; padding: 5px; border-radius: 8px; color: #333;">
            </div>
            
            <label style="display:block; font-size:14px; font-weight:bold; margin-bottom:5px; color:#1d2b64;">Email List:</label>
            <textarea id="moana-email-list" rows="3" placeholder="Paste emails here..." 
                style="width: 100%; padding: 12px; border: 2px solid #0077be !important; border-radius: 12px; background: #f0faff !important; color: #000 !important; font-size: 14px; outline: none; margin-bottom: 15px; box-sizing: border-box; height: 100px !important;"></textarea>
            
            <label style="display:block; font-size:14px; font-weight:bold; margin-bottom:5px; color:#1d2b64;">Set Password:</label>
            <input type="text" id="moana-pass-input" placeholder="e.g., 123456" 
                style="width: 100%; padding: 12px; border: 2px solid #0077be !important; border-radius: 12px; background: #f0faff !important; color: #000 !important; font-size: 14px; outline: none; margin-bottom: 15px; box-sizing: border-box; height: 50px !important;">
            
            <button class="btn" style="background:#0077be; color:white; border:none; width:100%; padding: 14px; border-radius: 12px; font-weight: bold; font-size: 16px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,119,190,0.3);" onclick="moanaGenerate()">Generate Format ‚ú®</button>
            
            <label style="display:block; font-size:14px; font-weight:bold; margin-bottom:5px; color:#1d2b64;">Final Output:</label>
            <textarea id="moana-output" rows="3" readonly 
                style="width: 100%; padding: 12px; border: 2px solid #455a64 !important; border-radius: 12px; background: #eceff1 !important; color: #000 !important; font-size: 14px; outline: none; margin-bottom: 15px; box-sizing: border-box; height: 100px !important;"></textarea>
            
            <button class="btn" style="background:#546e7a; color:white; border:none; width:100%; padding: 14px; border-radius: 12px; font-weight: bold;" onclick="moanaCopy()">üìã Copy Result</button>
        </div>
    </div>
</div>
<!-- UPDATED UNIVERSAL PREVIEWER (With Expiry & Short Link Support) -->
<div id="public-share-view" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: radial-gradient(circle at top, #1d2b64, #000000); z-index:40000; overflow-y:auto; padding:20px; font-family: 'Poppins', sans-serif; color: white;">
    <div class="glass-ui" style="max-width:600px; margin: 40px auto; padding:35px; border:1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; position: relative;">
        
        <!-- ‡ßß. ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® (‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá ‡¶Ø‡¶¶‡¶ø ‡¶∏‡¶Æ‡ßü ‡¶∂‡ßá‡¶∑ ‡¶π‡ßü) -->
        <div id="expire-screen" style="display:none; text-align:center; padding:40px 20px;">
            <i class="fas fa-hourglass-end fa-4x" style="color:var(--danger); margin-bottom:25px; opacity:0.8;"></i>
            <h2 style="color:white; margin-bottom:15px;">Link Expired!</h2>
            <p style="color:#aaa; font-size:0.9rem; line-height:1.6;">Sorry, this link has expired in 24 hours. Please contact the admin for a new link.</p>
        </div>

        <!-- ‡ß®. ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡ßç‡¶∞‡ßã‡¶ü‡ßá‡¶ï‡¶∂‡¶® ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® -->
        <div id="password-screen" style="display:none; text-align:center; padding:20px;">
            <i class="fas fa-lock fa-3x" style="color:var(--primary); margin-bottom:20px;"></i>
            <h3 style="margin-bottom:10px;">Locked Content</h3>
            <p style="font-size:0.8rem; color:#aaa; margin-bottom:20px;">A password is required to view this.</p>
            <input type="password" id="share-pass-input" placeholder="Password" style="text-align:center; border:1px solid var(--primary); margin-bottom:15px; background:rgba(255,255,255,0.05); color:white; border-radius:10px; padding:12px; width:85%;">
            <button class="btn" onclick="verifySharePassword()" style="background:var(--primary); color:black; font-weight:bold; width:auto; padding:10px 30px;">Unlock Now</button>
        </div>

        <!-- ‡ß©. ‡¶Æ‡ßá‡¶á‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶è‡¶∞‡¶ø‡ßü‡¶æ -->
        <div id="share-content-area" style="display:none;">
            <div style="text-align:center; padding:50px;">
                <i class="fas fa-circle-notch fa-spin fa-3x" style="color:var(--primary);"></i>
                <p style="margin-top:15px;">Loading Data...</p>
            </div>
        </div>
    </div>
</div>
    <!-- AI CHAT BOT WIDGET -->
    <button id="chatbot-trigger" class="glass-ui"><i class="fas fa-robot"></i></button>
    <div id="chatbot-container" class="glass-ui">
        <div class="chat-header"><span><i class="fas fa-robot"></i> Smart Assistant</span><button id="close-chat"><i class="fas fa-times"></i></button></div>
        <div class="chat-messages" id="chat-messages"><div class="message bot">Hello Boss! How Are You? </div></div>
        <div class="chat-input-area">
            <button id="chat-img-btn"><i class="fas fa-image"></i></button>
            <input type="text" id="chat-input" placeholder="Ask me anything...">
            <button id="chat-send-btn"><i class="fas fa-paper-plane"></i></button>
        </div>
        <input type="file" id="chat-file-input" accept="image/*" style="display: none;">
    </div>
<!-- Custom Confirm Modal -->
<div id="custom-confirm-overlay">
    <div id="custom-confirm-box">
        <p id="confirm-msg">Are you sure?</p>
        <div class="confirm-btns">
            <button class="confirm-btn btn-no" onclick="closeConfirm(false)">CANCEL</button>
            <button class="confirm-btn btn-yes" onclick="closeConfirm(true)">OK</button>
        </div>
    </div>
</div>
   <div id="reader" style="display:none;"></div>
    <input type="file" id="qr-file-input" accept="image/*" style="display: none;">

    <!-- Firebase & JS -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
     
<script>
    let auth, db; 
    let customBotData = [];
let currentSharedData = null;
    document.addEventListener('DOMContentLoaded', function() {
        const firebaseConfig = {
            apiKey: "AIzaSyAXSLgGP_fEOblHAqf1bGU5ENkUckmPnm4",
            authDomain: "all-info-f4fd6.firebaseapp.com",
            projectId: "all-info-f4fd6",
            storageBucket: "all-info-f4fd6.firebasestorage.app",
            messagingSenderId: "622193874862",
            appId: "1:622193874862:web:aff830d0cfa9b93b875a3f"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        auth = firebase.auth(); db = firebase.firestore();
        
        

        const CURRENT_APP_VERSION = "5.1.0"; 
        let TG_BOT_TOKEN = ""; 
        let TG_CHAT_ID = "";

        let dailyData = [], bankData = [], goalData = [], dpsData = [], allInformation = [], allContacts = [];
        let categories = [{ name: 'Text Info', value: 'text' }, { name: 'Link Info', value: 'link' }, { name: 'Mail Info', value: 'mail' }, { name: 'Photo', value: 'photo' }, { name: 'Video', value: 'video' }, { name: 'Audio', value: 'audio' }, { name: 'File', value: 'file' }];
        let editingDocId = null; 
let customSettings = [];
        const loginPage = document.getElementById('login-page'); const adminPanel = document.getElementById('admin-panel'); const loginForm = document.getElementById('login-form'); const loginEmail = document.getElementById('login-email'); const loginPassword = document.getElementById('login-password'); const loginError = document.getElementById('login-error'); const logoutButton = document.getElementById('logout-button'); const navLinks = document.querySelectorAll('.bottom-nav a'); const pageContents = document.querySelectorAll('.page-content');
        
        // FINGERPRINT LOGIC (FOR KODULAR)
const fingerprintBtn = document.getElementById('fingerprint-btn');
// ‡¶¨‡¶æ‡¶ü‡¶®‡¶ü‡¶ø ‡¶∏‡¶¨ ‡¶∏‡¶Æ‡ßü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
fingerprintBtn.style.display = 'inline-block'; 
document.getElementById('fingerprint-text').style.display = 'block';

fingerprintBtn.addEventListener('click', function() {
    if (window.AppInventor) {
        window.AppInventor.setWebViewString("SCAN_FINGERPRINT");
    } else {
        alert("Not in Kodular App");
    }
});

        auth.onAuthStateChanged(user => {
            const loader = document.getElementById('loading-screen');
            if (user) { showAdminPanel(user); fetchDataFromFirestore(); fetchAppLockSettings(); fetchApiSettings(); fetchCommandSettings(); fetchBotTrainingData(); } else { showLoginPage(); }
            if(loader) { setTimeout(() => { loader.style.opacity = '0'; setTimeout(() => { loader.style.display = 'none'; }, 500); }, 1500); }
        });

        loginForm.addEventListener('submit', e => {
            e.preventDefault(); const email = loginEmail.value; const pass = loginPassword.value; const loginBtn = loginForm.querySelector('button');
            loginBtn.innerText = "Checking..."; loginError.textContent = "";
            auth.signInWithEmailAndPassword(email, pass).then(() => { localStorage.setItem('savedEmail', email); localStorage.setItem('savedPass', pass); loginBtn.innerText = "Login Success!"; })
            .catch(err => { loginBtn.innerText = "Login"; loginError.textContent = "Error: " + err.message; });
        });

        document.getElementById('toggle-password-btn').addEventListener('click', function() { const type = loginPassword.getAttribute('type') === 'password' ? 'text' : 'password'; loginPassword.setAttribute('type', type); this.classList.toggle('fa-eye'); this.classList.toggle('fa-eye-slash'); });
        // ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶≤‡¶ú‡¶ø‡¶ï

logoutButton.addEventListener('click', () => {
    window.confirmDelete("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?", function() {
        auth.signOut().then(() => {
            appLockData = null; 
            location.reload(); 
        });
    });
});
        
        function showAdminPanel(user) { loginPage.style.display = 'none'; adminPanel.style.display = 'block'; document.getElementById('chatbot-trigger').style.display = 'block'; setTimeout(checkForUpdates, 2000); }
        function showLoginPage() { loginPage.style.display = 'flex'; adminPanel.style.display = 'none'; document.getElementById('chatbot-trigger').style.display = 'none'; document.getElementById('chatbot-container').style.display = 'none'; }
        async function checkForUpdates() { if (!auth.currentUser) return; try { const doc = await db.collection('app_settings').doc('config').get(); if (doc.exists) { const data = doc.data(); if (data.latestVersion !== CURRENT_APP_VERSION) { document.getElementById('update-msg').textContent = data.updateMessage; document.getElementById('new-version-display').textContent = data.latestVersion; document.getElementById('update-link').href = data.downloadLink; document.getElementById('update-modal').style.display = 'flex'; } } } catch (error) { console.log(error); } }

        async function fetchDataFromFirestore() {
            const user = auth.currentUser; if (!user) return;
            try {
                const [infoSnap, contactSnap, dailySnap, bankSnap, goalSnap, dpsSnap] = await Promise.all([
                    db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('informations').orderBy('createdAt', 'desc').get(),
                    db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('contacts').orderBy('createdAt', 'desc').get(),
                    db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('daily_transactions').get(),
                    db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('bank_accounts').get(),
                    db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('savings_goals').get(),
                    db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('dps_schemes').get()
                ]);
                allInformation = infoSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })); allContacts = contactSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })); dailyData = dailySnap.docs.map(doc => ({ id: doc.id, ...doc.data() })); bankData = bankSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })); goalData = goalSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })); dpsData = dpsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderAllData(); refreshHisabAll();
            } catch (error) { console.error("Error fetching data:", error); }
        }
        function fetchBotTrainingData() { db.collection('global_bot_training').onSnapshot(snap => { customBotData = snap.docs.map(doc => doc.data()); }); }
        // ‡ßß. ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶ø‡ßü‡ßá ‡¶Ü‡¶∏‡¶æ
function fetchCommandSettings() { 
    const user = auth.currentUser; 
    if(!user) return; 
    // ‡¶π‡¶æ‡¶∞‡ßç‡¶°‡¶ï‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßÅ‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ
    db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('bot_settings').onSnapshot(snap => { 
        customSettings = snap.docs.map(doc => ({id: doc.id, ...doc.data()})); 
        renderSettingsList(); 
    }); 
}

// ‡ß®. ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
window.saveCommandSetting = async function() { 
    const logic = document.getElementById('setting-logic-select').value; 
    const cmd = document.getElementById('setting-custom-cmd').value.trim(); 
    if(!logic || !cmd) return alert("‡¶≤‡¶ú‡¶ø‡¶ï ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"); 

    const existing = customSettings.find(s => s.logicId === logic); 
    try {
        if(existing) { 
            await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('bot_settings').doc(existing.id).update({ command: cmd }); 
        } else { 
            await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('bot_settings').add({ logicId: logic, command: cmd }); 
        } 
        alert("Command Set Successfully! ‚úÖ"); 
        document.getElementById('setting-custom-cmd').value = ''; 
    } catch(e) { alert("Error saving command!"); }
}

// ‡ß©. ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü‡ßá ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶°‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
function renderSettingsList() { 
    const container = document.getElementById('settings-list-container'); 
    if(!container) return;
    container.innerHTML = ''; 
    customSettings.forEach(s => { 
        container.innerHTML += `
            <div class="setting-row" style="display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid rgba(255,255,255,0.05);">
                <div>
                    <span style="font-size:0.7rem; color:var(--primary);">${s.logicId}</span><br>
                    <b>"${s.command}"</b>
                </div>
                <div>
                    <button onclick="deleteCommandSetting('${s.id}')" style="background:none; border:none; color:var(--danger); cursor:pointer;"><i class="fas fa-trash"></i></button>
                </div>
            </div>`; 
    }); 
}

// ‡ß™. ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ
window.deleteCommandSetting = async function(id) { 
    window.confirmDelete("‡¶è‡¶á ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶°‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?", function() { 
        db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('bot_settings').doc(id).delete(); 
    }); 
}
        function renderAllData() { updateDashboard(); renderAllInfoPage(); renderAllContactsPage(); updateCounts(); }

        navLinks.forEach(link => { link.addEventListener('click', function(e) { e.preventDefault(); resetAddInfoForm(); resetAddContactForm(); const pageId = this.dataset.page + '-page'; pageContents.forEach(page => page.classList.toggle('active', page.id === pageId)); navLinks.forEach(l => l.classList.toggle('active', l.dataset.page === this.dataset.page)); }); });
        window.openAddContactPage = function() { resetAddContactForm(); document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active')); document.getElementById('add-contact-page').classList.add('active'); navLinks.forEach(l => l.classList.remove('active')); document.querySelector('a[data-page="add-contact"]').classList.add('active'); }
        window.switchPage = function(pageName) { document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active')); document.getElementById(pageName + '-page').classList.add('active'); navLinks.forEach(l => l.classList.remove('active')); const navItem = document.querySelector(`a[data-page="${pageName}"]`); if(navItem) navItem.classList.add('active'); }
        async function getNextId(counterName) { const user = auth.currentUser; const counterRef = db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('counters').doc(counterName); return db.runTransaction(async (transaction) => { const counterDoc = await transaction.get(counterRef); let newId = counterDoc.exists ? counterDoc.data().currentId + 1 : 1000; transaction.set(counterRef, { currentId: newId }); return newId; }); }

        document.getElementById('ai-scan-info-btn').addEventListener('click', () => runAIScan('info-content', 'ai-scan-info-btn')); document.getElementById('ai-scan-contact-btn').addEventListener('click', () => runAIScan('bulk-contact-text', 'ai-scan-contact-btn')); document.getElementById('ai-scan-mail-btn').addEventListener('click', () => runAIScan('bulk-mail-text', 'ai-scan-mail-btn'));
        async function fetchApiSettings() {
    const doc = await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('config').doc('telegram_api').get();
    if(doc.exists) {
        const data = doc.data();
        TG_BOT_TOKEN = data.token;
        TG_CHAT_ID = data.chatId;
        document.getElementById('display-bot-token').innerText = TG_BOT_TOKEN;
        document.getElementById('display-chat-id').innerText = TG_CHAT_ID;
    }
} 
        async function runAIScan(targetInputId, btnId) { const fileInput = document.createElement('input'); fileInput.type = 'file'; fileInput.accept = 'image/*'; fileInput.onchange = async (e) => { const file = e.target.files[0]; if (!file) return; const btn = document.getElementById(btnId); const originalHtml = btn.innerHTML; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...'; btn.disabled = true; try { const { data: { text } } = await Tesseract.recognize(file, 'eng'); const targetArea = document.getElementById(targetInputId); targetArea.value = targetArea.value ? targetArea.value + "\n" + text : text; alert("AI Text Extracted!"); } catch (err) { alert("Failed to scan."); } finally { btn.innerHTML = originalHtml; btn.disabled = false; } }; fileInput.click(); }

        const infoCategory = document.getElementById('info-category'); const textUploadGroup = document.getElementById('text-upload-group'); const linkUploadGroup = document.getElementById('link-upload-group'); const fileUploadGroup = document.getElementById('file-upload-group'); const mailBulkToggleWrapper = document.getElementById('mail-bulk-toggle-wrapper'); const mailBulkToggle = document.getElementById('mail-bulk-toggle'); const mailBulkMode = document.getElementById('mail-bulk-mode'); const mailManualMode = document.getElementById('mail-manual-mode'); const bulkMailText = document.getElementById('bulk-mail-text'); const addInfoForm = document.getElementById('add-info-form'); const mailRowsContainer = document.getElementById('mail-rows-container'); const processMailBtn = document.getElementById('process-mail-btn');
        infoCategory.addEventListener('change', function() { const cat = this.value; const fileInput = document.getElementById('info-file-input'); textUploadGroup.style.display = 'none'; linkUploadGroup.style.display = 'none'; mailBulkToggleWrapper.style.display = 'none'; mailBulkMode.style.display = 'none'; mailManualMode.style.display = 'none'; fileUploadGroup.style.display = 'none'; if (cat === 'text') textUploadGroup.style.display = 'block'; else if (cat === 'link') linkUploadGroup.style.display = 'block'; else if (cat === 'mail') { mailBulkToggleWrapper.style.display = 'flex'; triggerMailMode(); } else if (['photo', 'video', 'audio', 'file'].includes(cat)) { fileUploadGroup.style.display = 'block'; if(cat === 'photo') fileInput.accept = "image/*"; else if(cat === 'video') fileInput.accept = "video/*"; else if(cat === 'audio') fileInput.accept = "audio/*"; else fileInput.accept = ".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.html,.css,.js,.php,.py,.java,.json,.xml,.psd,.ai,.svg,.eps,.cdr,.zip,.rar,.7z,.tar,.gz,.epub,.mobi,.azw3,.djvu,.apk,.exe,.msi,.ipa,.sql,.db,.sqlite,.log,.ttf,.otf,.woff"; } });
        mailBulkToggle.addEventListener('change', triggerMailMode); function triggerMailMode() { if (infoCategory.value !== 'mail') return; mailBulkMode.style.display = mailBulkToggle.checked ? 'block' : 'none'; mailManualMode.style.display = mailBulkToggle.checked ? 'none' : 'block'; }
        processMailBtn.addEventListener('click', function() { const text = bulkMailText.value; if(!text.trim()) return; mailRowsContainer.innerHTML = ''; const lines = text.split(/\r?\n/); let currentEmail = null; lines.forEach(line => { let cleanLine = line.trim(); if(!cleanLine) return; const match = cleanLine.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)/); if (match) { const email = match[0]; let rawPass = cleanLine.substring(cleanLine.indexOf(email) + email.length).trim(); rawPass = rawPass.replace(/^[\s:\-|=>]+|^(password|pass|pwd|pword|pin)\s*[:=]?\s*/i, '').replace(/^[\s:\-|=>]+/, ''); if (rawPass.length > 0) { renderMailRow(email, rawPass); currentEmail = null; } else { currentEmail = email; } } else if (currentEmail) { let pass = cleanLine.trim().replace(/^[\s:\-|=>]+|^(password|pass|pwd|pword|pin)\s*[:=]?\s*/i, '').replace(/^[\s:\-|=>]+/, ''); if(pass) { renderMailRow(currentEmail, pass); currentEmail = null; } } }); mailRowsContainer.insertAdjacentHTML('beforeend', `<div class="mail-input-group"><input type="email" class="mail-email" placeholder="Email"><input type="text" class="mail-password" placeholder="Pass"><button type="button" class="add-mail-btn btn">+</button></div>`); mailBulkToggle.checked = false; triggerMailMode(); });

        addInfoForm.addEventListener('submit', async (e) => { e.preventDefault(); const user = auth.currentUser; // ‡¶è‡¶á ‡¶ï‡ßã‡¶°‡¶ü‡ßÅ‡¶ï‡ßÅ ‡¶¨‡¶∏‡¶æ‡¶®
const fileInput = document.getElementById('info-file-input');
if (fileInput.files.length > 0) {
    if (fileInput.files[0].size > 20 * 1024 * 1024) { // 20MB Check
        alert("‡¶≠‡ßÅ‡¶≤: ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø 2‡ß¶ ‡¶Æ‡ßá‡¶ó‡¶æ‡¶¨‡¶æ‡¶á‡¶ü‡ßá‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶¨‡ßú! ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶õ‡ßã‡¶ü ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¶‡¶ø‡¶®‡•§");
        const submitBtn = addInfoForm.querySelector('button[type="submit"]');
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'Add Information';
        return; // ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶¨‡ßá
    }
}
        const cat = infoCategory.value; 
        const titleInput = document.getElementById('info-title').value;
        const submitBtn = addInfoForm.querySelector('button[type="submit"]'); submitBtn.disabled = true; submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...'; try { if (['photo', 'video', 'audio', 'file'].includes(cat)) { const file = document.getElementById('info-file-input').files[0]; let contentToSave = ""; if (file) { document.getElementById('upload-status').innerText = "Uploading to TG Cloud..."; const formData = new FormData(); formData.append('chat_id', TG_CHAT_ID); formData.append('caption', titleInput); const apiMethod = (cat === 'photo') ? 'sendPhoto' : 'sendDocument'; const keyName = (cat === 'photo') ? 'photo' : 'document'; formData.append(keyName, file); const res = await fetch(`https://api.telegram.org/bot${TG_BOT_TOKEN}/${apiMethod}`, { method: 'POST', body: formData }); const data = await res.json(); if (!data.ok) throw new Error("Telegram API Error: " + data.description); let fileId; if (cat === 'photo') fileId = data.result.photo[data.result.photo.length - 1].file_id; else if (cat === 'video') fileId = data.result.video.file_id; else if (cat === 'audio') fileId = data.result.audio.file_id; else fileId = data.result.document.file_id; contentToSave = fileId; } else if (editingDocId) { const oldDoc = await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('informations').doc(editingDocId).get(); contentToSave = oldDoc.data().fullContent; } else throw new Error("Please select a file."); await saveInfoToDb(user, cat, titleInput, contentToSave); alert('File uploaded!'); } else if (cat === 'mail') { let finalEntries = []; document.querySelectorAll('.mail-input-group').forEach(row => { const mEmail = row.querySelector('.mail-email').value; const mPass = row.querySelector('.mail-password').value; if (mEmail || mPass) finalEntries.push(`Email: ${mEmail} | Password: ${mPass}`); }); await saveInfoToDb(user, 'mail', titleInput, finalEntries.join('|||')); alert('Added!'); } else { let content = (cat === 'text') ? document.getElementById('info-content').value : document.getElementById('info-link').value; await saveInfoToDb(user, cat, titleInput, content); alert('Added!'); } resetAddInfoForm(); fetchDataFromFirestore(); } catch(error) { alert("Error: " + error.message); } finally { submitBtn.disabled = false; submitBtn.innerHTML = 'Add Information'; document.getElementById('upload-status').innerText = ""; } });
        async function saveInfoToDb(user, cat, title, content, onlyTitle = false) { const infoData = { title: title, category: cat, date: new Date().toLocaleDateString() }; if(!onlyTitle) infoData.fullContent = content; if (editingDocId && cat !== 'mail') { await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('informations').doc(editingDocId).update(infoData); } else { if(onlyTitle) return; const newId = await getNextId('infoCounter'); infoData.createdAt = firebase.firestore.FieldValue.serverTimestamp(); await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('informations').doc(String(newId)).set(infoData); } }

        const addContactForm = document.getElementById('add-contact-form'); const contactBulkToggle = document.getElementById('contact-bulk-toggle'); const contactSubmitBtn = document.getElementById('contact-submit-btn');
        addContactForm.addEventListener('submit', async (e) => { e.preventDefault(); const user = auth.currentUser; if (contactBulkToggle.checked) { const rows = document.querySelectorAll('.bulk-contact-row'); if (rows.length === 0) return alert('No valid contacts.'); contactSubmitBtn.innerText = "Importing..."; contactSubmitBtn.disabled = true; try { let count = 0; for (const row of rows) { const bName = row.querySelector('.bulk-name').value; const bPhone = row.querySelector('.bulk-phone').value; if(bName || bPhone) { const newId = await getNextId('contactCounter'); await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('contacts').doc(String(newId)).set({ name: bName || "Unknown", phone: [bPhone], email: "", address: "", socialLinks: [], createdAt: firebase.firestore.FieldValue.serverTimestamp() }); count++; } } alert('Imported: ' + count); resetAddContactForm(); fetchDataFromFirestore(); } catch (error) { alert("Error."); } finally { contactSubmitBtn.innerText = "Add Contact"; contactSubmitBtn.disabled = false; } } else { const contactData = { name: document.getElementById('contact-name').value, phone: Array.from(document.querySelectorAll('.contact-phone')).map(i=>i.value).filter(Boolean), email: document.getElementById('contact-email').value, address: document.getElementById('contact-address').value, socialLinks: Array.from(document.querySelectorAll('.contact-social')).map(i=>i.value).filter(Boolean) }; if (editingDocId) { await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('contacts').doc(editingDocId).update(contactData); alert('Updated!'); } else { const newId = await getNextId('contactCounter'); contactData.createdAt = firebase.firestore.FieldValue.serverTimestamp(); await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('contacts').doc(String(newId)).set(contactData); alert('Added!'); } resetAddContactForm(); fetchDataFromFirestore(); } });
        function renderBulkRow(name, phone, address) { document.getElementById('bulk-contact-preview').insertAdjacentHTML('beforeend', `<div class="bulk-contact-row"><input type="text" class="bulk-name" value="${name}" placeholder="Name" style="flex:1;"><input type="text" class="bulk-phone" value="${phone}" placeholder="Phone" style="flex:1;"><button type="button" class="remove-btn btn" onclick="this.parentElement.remove()">-</button></div>`); }
        function renderMailRow(email, pass) { mailRowsContainer.insertAdjacentHTML('beforeend', `<div class="mail-input-group"><input type="email" class="mail-email" value="${email}"><input type="text" class="mail-password" value="${pass}"><button type="button" class="remove-btn btn">-</button></div>`); }
        
        // --- ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶¨‡¶æ‡¶≤‡ßç‡¶ï ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶∞ (‡¶è‡¶ü‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®) ---
document.getElementById('process-contact-btn').addEventListener('click', function() {
    const text = document.getElementById('bulk-contact-text').value;
    if(!text.trim()) return;

    const previewArea = document.getElementById('bulk-contact-preview');
    previewArea.innerHTML = ''; 
    
    const lines = text.split(/\r?\n/);
    let foundCount = 0;

    lines.forEach(line => {
        let cleanLine = line.trim();
        if(!cleanLine) return;

        // ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü‡¶≤‡¶ø ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ
        const phoneMatch = cleanLine.match(/(\+?88)?01[3-9]\d{8}/);
        let phone = phoneMatch ? phoneMatch[0] : "";
        
        // ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¨‡¶æ‡¶¶‡ßá ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶Ö‡¶Ç‡¶∂‡¶ï‡ßá ‡¶®‡¶æ‡¶Æ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶ß‡¶∞‡¶æ
        let name = cleanLine.replace(phone, "")
                            .replace(/[:\-\|=\|\/]/g, "") // ‡¶¨‡¶æ‡ßú‡¶§‡¶ø ‡¶ö‡¶ø‡¶π‡ßç‡¶® ‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ
                            .trim();

        if (name || phone) {
            renderBulkRow(name || "Unknown Name", phone || "No Number");
            foundCount++;
        }
    });
    
    if(foundCount > 0) {
        alert(foundCount + " ‡¶ü‡¶ø ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßá 'Add Contact' ‡¶¶‡¶ø‡¶®‡•§");
    } else {
        alert("‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶†‡¶ø‡¶ï ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§");
    }
});
        document.body.addEventListener('click', function(e) { if (e.target.classList.contains('add-phone-btn')) document.getElementById('phone-numbers-container').insertAdjacentHTML('beforeend', `<div class="phone-input-group"><input type="tel" class="contact-phone"><button type="button" class="remove-btn btn">-</button></div>`); if (e.target.classList.contains('add-social-btn')) document.getElementById('social-links-container').insertAdjacentHTML('beforeend', `<div class="social-input-group"><input type="url" class="contact-social"><button type="button" class="remove-btn btn">-</button></div>`); if (e.target.classList.contains('add-mail-btn')) mailRowsContainer.insertAdjacentHTML('beforeend', `<div class="mail-input-group"><input type="email" class="mail-email"><input type="text" class="mail-password"><button type="button" class="remove-btn btn">-</button></div>`); if (e.target.classList.contains('remove-btn') && !e.target.parentElement.classList.contains('bulk-contact-row')) e.target.parentElement.remove(); });
        
        const filterBtns = document.querySelectorAll('.filter-btn'); const searchButton = document.getElementById('search-button'); const searchKeyword = document.getElementById('search-keyword'); const infoModal = document.getElementById('info-modal'); const closeInfoModalBtn = document.getElementById('close-info-modal'); const infoModalHeader = document.getElementById('info-modal-header'); const infoModalBody = document.getElementById('info-modal-body'); const infoModalFooter = document.getElementById('info-modal-footer');
        filterBtns.forEach(btn => { btn.addEventListener('click', function() { filterBtns.forEach(b => b.classList.remove('active')); this.classList.add('active'); const cat = this.dataset.category; document.querySelectorAll('#all-info-table tr').forEach(row => row.style.display = (cat === 'all' || row.dataset.category === cat) ? '' : 'none'); }); });
        searchButton.addEventListener('click', performSearch); searchKeyword.addEventListener('keyup', e => e.key === 'Enter' && performSearch());
        closeInfoModalBtn.addEventListener('click', () => infoModal.style.display = 'none'); window.addEventListener('click', e => { if (e.target === infoModal) infoModal.style.display = 'none'; });
        function performSearch() {
            const cat = document.getElementById('search-category').value; const key = document.getElementById('search-keyword').value.toLowerCase().trim(); const tbody = document.getElementById('search-results-tbody');
            document.getElementById('search-results-thead').innerHTML = `<tr><th>ID</th><th>Title/Name</th><th>Category</th><th>Actions</th></tr>`; tbody.innerHTML = ''; const safeStr = (str) => (str ? String(str).toLowerCase() : ""); let res = [];
            if (cat === 'all' || ['text','link','mail','photo','video','audio','file'].includes(cat)) { res.push(...allInformation.filter(i => (cat === 'all' || i.category === cat) && (safeStr(i.title).includes(key) || safeStr(i.fullContent).includes(key) || safeStr(i.id).includes(key))).map(i => ({...i, type: 'info'}))); }
            if (cat === 'all' || cat === 'contacts') { res.push(...allContacts.filter(c => (safeStr(c.name).includes(key) || safeStr(c.email).includes(key) || safeStr(c.address).includes(key) || (c.phone && c.phone.some(p => safeStr(p).includes(key))))).map(c => ({...c, type: 'contact'}))); }
            if(res.length > 0) { 
    res.forEach(i => { 
        // ‡ßß. ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶è‡¶ü‡¶æ ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶®‡¶æ‡¶ï‡¶ø ‡¶á‡¶®‡¶´‡ßã
        const isContact = (i.type === 'contact');
        
        // ‡ß®. ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶∞‡ßã (Row) ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        tbody.innerHTML += `<tr>
            <td>${i.id}</td>
            <td>${i.title || i.name}</td>
            <td>${isContact ? 'Contact' : getCategoryName(i.category)}</td>
            <td class="action-buttons">
                <button class="open-btn" onclick="${isContact ? 'openContactInfo' : 'openInfoModal'}('${i.id}')">View</button>
                
                <!-- ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®: ‡¶Ø‡ßá‡¶ñ‡¶æ‡¶®‡ßá ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶π‡¶≤‡ßá true ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá -->
                <button class="edit-btn" title="Share" onclick="shareInformation('${i.id}', ${isContact})" style="color:var(--success); margin-left:5px;">
                    <i class="fas fa-share-alt"></i>
                </button>
                
                <button class="edit-btn" onclick="${isContact ? 'editContact' : 'editInfo'}('${i.id}')"><i class="fas fa-edit"></i></button>
                <button class="delete-btn" onclick="${isContact ? 'deleteContact' : 'deleteInfo'}('${i.id}')"><i class="fas fa-trash"></i></button>
            </td>
        </tr>`; 
    }); 
}
 else { tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No results found.</td></tr>'; }
        }

        function updateDashboard() { const rInfo = document.getElementById('recent-info-table'); if(rInfo) { rInfo.innerHTML = ''; allInformation.slice(0, 5).forEach(i => rInfo.innerHTML += `<tr><td>${i.id}</td><td>${i.title}</td><td class="action-buttons"><button class="open-btn" onclick="openInfoModal('${i.id}')">View</button></td></tr>`); } const rCont = document.getElementById('recent-contacts-table'); if(rCont) { rCont.innerHTML = ''; allContacts.slice(0, 5).forEach(c => rCont.innerHTML += `<tr><td>${c.name}</td><td>${c.phone?.[0] || 'N/A'}</td><td class="action-buttons"><button class="open-btn" onclick="openContactInfo('${c.id}')">View</button></td></tr>`); } }
        function renderAllInfoPage() { const tbl = document.getElementById('all-info-table'); tbl.innerHTML = ''; allInformation.forEach(i => { const row = tbl.insertRow(); row.dataset.category = i.category; row.innerHTML = `<td>${i.id}</td><td>${i.title}</td><td>${getCategoryName(i.category)}</td><td class="action-buttons"><button class="open-btn" onclick="openInfoModal('${i.id}')">View</button><button class="edit-btn" title="Share" onclick="shareInformation('${i.id}')" style="color:var(--success); margin-left:5px;">
    <i class="fas fa-share-alt"></i>
</button><button class="edit-btn" onclick="editInfo('${i.id}')"><i class="fas fa-edit"></i></button><button class="delete-btn" onclick="deleteInfo('${i.id}')"><i class="fas fa-trash"></i></button></td>`; }); }
        
function renderAllContactsPage() { 
    const tbl = document.getElementById('all-contacts-table'); 
    tbl.innerHTML = ''; 
    allContacts.forEach(c => {
        tbl.innerHTML += `<tr>
            <td>${c.name}</td>
            <td>${c.address || 'N/A'}</td>
            <td class="action-buttons">
                <button class="open-btn" onclick="openContactInfo('${c.id}')">View</button>
                
                <!-- ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá -->
                <button class="edit-btn" title="Share" onclick="shareInformation('${c.id}', true)" style="color:var(--success); margin-left:5px;">
                    <i class="fas fa-share-alt"></i>
                </button>
                
                <button class="edit-btn" onclick="editContact('${c.id}')"><i class="fas fa-edit"></i></button>
                <button class="delete-btn" onclick="deleteContact('${c.id}')"><i class="fas fa-trash"></i></button>
            </td>
        </tr>`;
    }); 
}
        function getCategoryName(v) { return (categories.find(c => c.value === v) || {}).name || v; }
        function updateCounts() { const dashTotal = document.getElementById('dash-total-info'); if(dashTotal) dashTotal.textContent = allInformation.length; document.getElementById('count-photo').textContent = allInformation.filter(i => i.category === 'photo').length; document.getElementById('count-video').textContent = allInformation.filter(i => i.category === 'video').length; document.getElementById('count-audio').textContent = allInformation.filter(i => i.category === 'audio').length; document.getElementById('count-file').textContent = allInformation.filter(i => i.category === 'file').length; document.getElementById('count-text').textContent = allInformation.filter(i => i.category === 'text').length; document.getElementById('count-link').textContent = allInformation.filter(i => i.category === 'link').length; document.getElementById('count-mail').textContent = allInformation.filter(i => i.category === 'mail').length; document.getElementById('count-contacts').textContent = allContacts.length; }
        // ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°: ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ö‡ßá‡¶ï‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        async function getTelegramLink(fileId) { 
            if (!fileId) return null;
            try { 
                // TG_BOT_TOKEN ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶â‡¶™‡¶∞‡ßá ‡¶°‡¶ø‡¶´‡¶æ‡¶á‡¶® ‡¶ï‡¶∞‡¶æ ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá
                const res = await fetch(`https://api.telegram.org/bot${TG_BOT_TOKEN}/getFile?file_id=${fileId}`); 
                const data = await res.json(); 
                
                if (data.ok) { 
                    return `https://api.telegram.org/file/bot${TG_BOT_TOKEN}/${data.result.file_path}`; 
                } else {
                    console.error("Telegram API says file gone:", data.description);
                    return null; 
                }
            } catch (e) { 
                console.error("Network Error in getTelegramLink:", e); 
                return null;
            } 
        }

        // ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°: ‡¶á‡¶®‡¶´‡ßã ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶ì‡¶™‡ßá‡¶®‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        window.openInfoModal = async function(id) { 
            const i = allInformation.find(x => x.id === id); 
            if (!i) {
                alert("Error: Information not found!");
                return; 
            }
            
            // ‡ßß. ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá‡¶á ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá (‡¶Ø‡¶æ‡¶§‡ßá ‡¶Æ‡¶®‡ßá ‡¶®‡¶æ ‡¶π‡ßü ‡¶π‡ßç‡¶Ø‡¶æ‡¶Ç ‡¶ï‡¶∞‡ßá‡¶õ‡ßá)
            infoModal.style.display = 'flex'; 
            infoModalHeader.innerHTML = `<h2>${i.title}</h2>`; 
            
            // ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
            infoModalBody.innerHTML = '<div style="text-align:center; padding:30px;"><i class="fas fa-spinner fa-spin" style="font-size:2rem; color:var(--primary);"></i><p style="margin-top:10px;">Loading Content...</p></div>'; 
            infoModalFooter.innerHTML = ''; 

            try {
                if (i.category === 'text') {
                    infoModalBody.textContent = i.fullContent; 
                }
                else if (i.category === 'link') {
                    infoModalBody.innerHTML = `<div style="padding:10px; text-align:center;"><a href="${i.fullContent}" target="_blank" class="btn" style="background:var(--secondary);">Open Link <i class="fas fa-external-link-alt"></i></a><p style="margin-top:10px; word-break:break-all; font-size:0.8rem; color:#aaa;">${i.fullContent}</p></div>`; 
                }
                else if (i.category === 'mail') { 
                    let mailHtml = '';
                    i.fullContent.split('|||').forEach((acc, idx) => { 
                        const [e, p] = acc.split(' | Password: ').map(s => s.replace('Email: ', '')); 
                        mailHtml += `<div class="mail-entry-box"><h4>Mail ${idx+1}</h4><div class="mail-row-compact"><div>${e}</div><button class="copy-btn-small" onclick="navigator.clipboard.writeText('${e}')"><i class="fas fa-copy"></i></button></div><div class="mail-row-compact"><div>${p||''}</div><button class="copy-btn-small" onclick="navigator.clipboard.writeText('${p||''}')"><i class="fas fa-copy"></i></button></div></div>`; 
                    }); 
                    infoModalBody.innerHTML = mailHtml;
                    infoModalFooter.innerHTML = `<button class="btn" style="background:var(--secondary); color:white;" onclick="downloadMailPDF('${i.id}')"><i class="fas fa-file-pdf"></i> Download PDF</button>`; 
                } 
                else if (['photo', 'video', 'audio', 'file'].includes(i.category)) { 
                    
                    // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                    const url = await getTelegramLink(i.fullContent); 
                    
                    // ‡¶Ø‡¶¶‡¶ø ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü
                    if (!url) { 
                        infoModalBody.innerHTML = `
                            <div style="text-align:center; padding:20px;">
                                <i class="fas fa-trash-alt" style="font-size:3rem; color:var(--danger); margin-bottom:15px;"></i>
                                <h3 style="color:var(--danger);">File Deleted!</h3>
                                <p style="color:#ccc; font-size:0.9rem;">This file has been removed from the server.</p>
                            </div>`; 
                        return; 
                    } 

                    // ‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶ó‡ßá‡¶≤‡ßá ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶∂‡ßã ‡¶ï‡¶∞‡¶æ
                    if (i.category === 'photo') { 
                        infoModalBody.innerHTML = `<img src="${url}" style="max-width:100%; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.5);">`; 
                        infoModalFooter.innerHTML = `<a href="${url}" target="_blank" class="btn" download>Download Image</a>`; 
                    } else if (i.category === 'video') { 
                        infoModalBody.innerHTML = `<video controls autoplay style="width:100%; border-radius:10px;"><source src="${url}" type="video/mp4"></video>`; 
                        infoModalFooter.innerHTML = `<a href="${url}" target="_blank" class="btn">Download Video</a>`; 
                    } else if (i.category === 'audio') { 
                        infoModalBody.innerHTML = `<div style="padding:20px; text-align:center;"><i class="fas fa-music" style="font-size:3rem; color:var(--secondary); margin-bottom:15px;"></i><br><audio controls style="width:100%;"><source src="${url}" type="audio/mpeg"></audio></div>`; 
                        infoModalFooter.innerHTML = `<a href="${url}" target="_blank" class="btn">Download Audio</a>`; 
                    } else if (i.category === 'file') { 
                        infoModalBody.innerHTML = `<div style="text-align:center; padding:20px;"><i class="fas fa-file-alt" style="font-size:4rem; color:var(--primary);"></i><p style="margin-top:15px;">Document Ready</p></div>`; 
                        infoModalFooter.innerHTML = `<a href="${url}" target="_blank" class="btn">Open / Download File</a>`; 
                    } 
                } 
            } catch (err) {
                console.error(err);
                infoModalBody.innerHTML = `<p style="color:red; text-align:center;">Something went wrong!<br><small>${err.message}</small></p>`;
            }
        } 
        
        window.downloadMailPDF = function(id) { const i = allInformation.find(x => x.id === id); if (!i) return; const doc = new jsPDF(); doc.text(i.title, 10, 10); doc.setFontSize(11); let y = 20; i.fullContent.split('|||').forEach((acc, idx) => { if (y > 270) { doc.addPage(); y = 10; } const [e, p] = acc.split(' | Password: ').map(s => s.replace('Email: ', '')); doc.text(`${idx+1}. Email: ${e}`, 10, y); doc.text(`   Password: ${p || 'N/A'}`, 10, y+5); y += 15; }); doc.save(`${i.title}.pdf`); }
        window.openContactInfo = function(id) { const c = allContacts.find(x => x.id === id); if (!c) return; infoModalHeader.innerHTML = `<h2>${c.name}</h2>`; let phoneHtml = c.phone.map(p => `<span>${p}</span>`).join(' | '); infoModalBody.innerHTML = `<p>Phone: ${phoneHtml}</p><p>Email: ${c.email}</p><p>Address: ${c.address}</p>`; infoModalFooter.innerHTML = ''; infoModal.style.display = 'flex'; }
        window.deleteInfo = function(id) { 
    window.confirmDelete('‡¶è‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?', function() {
        db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('informations').doc(id).delete().then(() => {
            fetchDataFromFirestore();
            alert("Deleted!");
        });
    });
}
        window.deleteContact = function(id) { 
    window.confirmDelete('‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?', function() {
        db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('contacts').doc(id).delete().then(() => {
            fetchDataFromFirestore();
            alert("Contact Deleted!");
        });
    });
}
        window.editInfo = function(id) { const i = allInformation.find(x => x.id === id); if (!i) return; document.querySelector('a[data-page="add-info"]').click(); editingDocId = id; document.getElementById('info-title').value = i.title; infoCategory.value = i.category; infoCategory.dispatchEvent(new Event('change')); if(i.category === 'text') document.getElementById('info-content').value = i.fullContent; else if(i.category === 'link') document.getElementById('info-link').value = i.fullContent; }
        window.editContact = function(id) { const c = allContacts.find(x => x.id === id); if (!c) return; openAddContactPage(); editingDocId = id; contactBulkToggle.checked = false; document.getElementById('contact-name').value = c.name; document.getElementById('contact-email').value = c.email; document.getElementById('contact-address').value = c.address; }
        function resetAddInfoForm() { editingDocId = null; addInfoForm.reset(); infoCategory.dispatchEvent(new Event('change')); }
        function resetAddContactForm() { editingDocId = null; addContactForm.reset(); document.getElementById('bulk-contact-preview').innerHTML = ''; }
        window.switchHisabTab = function(tab) { document.querySelectorAll('.hisab-view').forEach(v => v.classList.remove('active')); document.getElementById(`hisab-view-${tab}`).classList.add('active'); document.querySelectorAll('.hisab-tab').forEach(t => t.classList.remove('active')); event.currentTarget.classList.add('active'); }
        window.refreshHisabAll = function() {
            let cash = dailyData.reduce((acc, t) => t.type==='inc' ? acc + parseFloat(t.amount || 0) : acc - parseFloat(t.amount || 0), 0);
let bank = bankData.reduce((acc, b) => acc + parseFloat(b.balance || 0), 0);
let goal = goalData.reduce((acc, g) => acc + parseFloat(g.balance || 0), 0);
let dps = dpsData.reduce((acc, d) => acc + parseFloat(d.paid || 0), 0);
            let total = cash + bank + goal + dps;
            document.getElementById('net-worth').innerText = '‡ß≥ ' + total.toLocaleString(); document.getElementById('sum-cash').innerText = '‡ß≥ ' + cash.toLocaleString(); document.getElementById('sum-bank').innerText = '‡ß≥ ' + bank.toLocaleString(); document.getElementById('sum-goal').innerText = '‡ß≥ ' + goal.toLocaleString(); document.getElementById('sum-dps').innerText = '‡ß≥ ' + dps.toLocaleString(); document.getElementById('dashboard-net-worth').innerText = '‡ß≥ ' + total.toLocaleString(); document.getElementById('dash-cash').innerText = cash; document.getElementById('dash-bank').innerText = bank; document.getElementById('dash-savings').innerText = goal+dps;
            renderHisabDaily(); renderHisabBank(); renderHisabGoal(); renderHisabDPS();
        }
        function renderHisabDaily() { const list = document.getElementById('daily-list'); list.innerHTML = ''; dailyData.forEach(t => list.innerHTML += `<div class="hisab-card row-between" style="border-left:5px solid ${t.type==='inc'?'#10B981':'#EF4444'}"><div><b>${t.cat}</b><br><small style="color:#aaa">${t.date}</small></div><div style="display:flex;align-items:center;"><b style="color:${t.type==='inc'?'#10B981':'#EF4444'}">${t.type==='inc'?'+':'-'} ${t.amount}</b><button class="list-delete-btn" onclick="deleteHisabItem('daily_transactions', '${t.id}')"><i class="fas fa-trash"></i></button></div></div>`); }
       function renderHisabBank() {
    const list = document.getElementById('bank-list');
    list.innerHTML = '';
    bankData.forEach(b => list.innerHTML += `
        <div class="hisab-card bank row-between">
            <div>
                <h3 style="color:var(--primary);">${b.name}</h3>
                <h2 style="margin:5px 0;">‡ß≥ ${b.balance}</h2>
                <p style="font-size:0.8rem;color:gray">Ac: ${b.num || 'N/A'}</p>
            </div>
            <div style="display: flex; flex-direction: column; gap: 10px; align-items: flex-end;">
                <!-- ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ${b.id} ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶Ø‡¶æ‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶ì‡¶á ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï‡¶á ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶π‡ßü -->
                <button class="pay-btn" onclick="openHisabModal('bank_tran', '${b.id}')" style="background:var(--bank-color); color:white; padding: 8px 15px;">Transact</button>
                <button class="list-delete-btn" onclick="deleteHisabItem('bank_accounts', '${b.id}')" style="background:rgba(230, 57, 70, 0.1); padding:8px;"><i class="fas fa-trash"></i></button>
            </div>
        </div>`);
}
        function renderHisabGoal() {
    const list = document.getElementById('goal-list');
    list.innerHTML = '';
    
    goalData.forEach(g => {
        // ‡¶ï‡¶§ ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶§‡¶æ ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ (‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ßß‡ß¶‡ß¶% ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§)
        const target = parseFloat(g.target) || 1; // ‡¶Ø‡¶æ‡¶§‡ßá ‡ß¶ ‡¶¶‡¶ø‡ßü‡ßá ‡¶≠‡¶æ‡¶ó ‡¶π‡ßü‡ßá ‡¶≠‡ßÅ‡¶≤ ‡¶®‡¶æ ‡¶π‡ßü
        let percent = Math.min((parseFloat(g.balance) / target) * 100, 100).toFixed(0);
        
        list.innerHTML += `
            <div class="hisab-card goal">
                <div class="row-between">
                    <div>
                        <b style="font-size:1.1rem; color:var(--text-light);">${g.name}</b>
                        <h2 style="margin:2px 0; color:var(--goal-color);">‡ß≥ ${g.balance}</h2>
                        <small style="color:gray;">Target: ‡ß≥ ${g.target}</small>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px; align-items: flex-end;">
                        <button class="pay-btn" onclick="openHisabModal('goal_tran', '${g.id}')" style="background:var(--goal-color); color:white; padding: 6px 12px; border-radius:8px; font-size:0.8rem;">Add Save</button>
                        <button class="list-delete-btn" onclick="deleteHisabItem('savings_goals', '${g.id}')" style="background:rgba(230, 57, 70, 0.1); padding:6px; border-radius:8px;"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
                
                <!-- ‡¶á‡¶®‡ßç‡¶°‡¶ø‡¶ï‡ßá‡¶ü‡¶∞ ‡¶¨‡¶æ ‡¶™‡ßç‡¶∞‡¶ó‡ßç‡¶∞‡ßá‡¶∏ ‡¶¨‡¶æ‡¶∞ -->
                <div class="goal-progress-wrapper">
                    <span class="percent-text">${percent}% Completed</span>
                    <div class="progress-bg">
                        <div class="progress-fill" style="width: ${percent}%;"></div>
                    </div>
                </div>
            </div>`;
    });
}
        function renderHisabDPS() {
    const list = document.getElementById('dps-list');
    list.innerHTML = '';
    dpsData.forEach(d => list.innerHTML += `
        <div class="hisab-card dps row-between">
            <div>
                <b style="font-size:1.1rem;">${d.bank}</b>
                <p style="margin-top:5px;">Saved: ‡ß≥ ${d.paid}</p>
                <small style="color:gray;">Next: ${d.nextDate}</small>
            </div>
            <div style="display: flex; flex-direction: column; gap: 10px; align-items: flex-end;">
                <button class="pay-btn" onclick="payHisabDPS('${d.id}')" style="padding: 8px 15px; font-weight:bold;">Pay Now</button>
                <button class="list-delete-btn" onclick="deleteHisabItem('dps_schemes', '${d.id}')" style="background:rgba(230, 57, 70, 0.1); padding:8px;"><i class="fas fa-trash"></i></button>
            </div>
        </div>`);
}
        window.openHisabModal = function(context, selectedId = null) { document.getElementById('hisab-modal').style.display = 'flex'; document.getElementById('hisab-modal-context').value = context; const div = document.getElementById('hisab-modal-inputs'); div.innerHTML = ''; const di = `<input type="date" id="hinp-date" value="${new Date().toISOString().split('T')[0]}">`, ai = `<input type="number" id="hinp-amt" placeholder="Amount (Tk)">`; if(context === 'daily_entry') div.innerHTML = `<select id="hinp-type"><option value="inc">Income</option><option value="exp">Expense</option></select><input type="text" id="hinp-cat" placeholder="Category"> ${ai} ${di}`; else if(context === 'new_bank') div.innerHTML = `<input type="text" id="hinp-name" placeholder="Bank Name"><input type="text" id="hinp-desc" placeholder="Acc Number"> ${ai}`; else if(context === 'bank_tran') div.innerHTML = `<select id="hinp-idx">${bankData.map(b=>`<option value="${b.id}" ${b.id === selectedId ? 'selected' : ''}>${b.name}</option>`).join('')}</select><select id="hinp-action"><option value="dep">Deposit</option><option value="with">Withdraw</option></select> ${ai} ${di}`; else if(context === 'new_goal') div.innerHTML = `<input type="text" id="hinp-name" placeholder="Goal Name"> ${ai}`; // ‡¶è‡¶ü‡¶ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡ßü‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®
else if(context === 'goal_tran') {
    div.innerHTML = `
        <select id="hinp-idx">
            ${goalData.map(g => `<option value="${g.id}" ${g.id === selectedId ? 'selected' : ''}>${g.name}</option>`).join('')}
        </select>
        <select id="hinp-action">
            <option value="add">Add (+)</option>
            <option value="remove">Remove (-)</option>
        </select> 
        ${ai}`;
}
 else if(context === 'new_dps') div.innerHTML = `<input type="text" id="hinp-name" placeholder="Bank Name"><input type="number" id="hinp-amt" placeholder="Monthly Installment"><input type="number" id="hinp-desc" placeholder="Total Target"> ${di}`; }
        window.submitHisabData = async function() { const user = auth.currentUser; const ctx = document.getElementById('hisab-modal-context').value; const amt = parseFloat(document.getElementById('hinp-amt')?.value || 0);
            try { if(ctx === 'daily_entry') await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('daily_transactions').add({ type: document.getElementById('hinp-type').value, amount: amt, cat: document.getElementById('hinp-cat').value||'Others', date: document.getElementById('hinp-date').value });
            else if(ctx === 'new_bank') await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('bank_accounts').add({ name: document.getElementById('hinp-name').value, num: document.getElementById('hinp-desc').value, balance: amt, history: [] });
            else if(ctx === 'bank_tran') { const id = document.getElementById('hinp-idx').value; const act = document.getElementById('hinp-action').value; const b = bankData.find(x => x.id === id); await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('bank_accounts').doc(id).update({ balance: act === 'dep' ? parseFloat(b.balance)+amt : parseFloat(b.balance)-amt }); }
            else if(ctx === 'new_goal') await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('savings_goals').add({ name: document.getElementById('hinp-name').value, target: amt, balance: 0 });
            else if(ctx === 'goal_tran') { const id = document.getElementById('hinp-idx').value; const act = document.getElementById('hinp-action').value; const g = goalData.find(x => x.id === id); await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('savings_goals').doc(id).update({ balance: act === 'add' ? parseFloat(g.balance)+amt : parseFloat(g.balance)-amt }); }
            else if(ctx === 'new_dps') { const start = document.getElementById('hinp-date').value; let next = new Date(start); next.setMonth(next.getMonth()+1); await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('dps_schemes').add({ bank: document.getElementById('hinp-name').value, monthly: amt, target: parseFloat(document.getElementById('hinp-desc').value), paid: 0, nextDate: next.toISOString().split('T')[0] }); }
            document.getElementById('hisab-modal').style.display = 'none'; fetchDataFromFirestore(); alert("Saved!"); } catch(e) { console.error(e); alert("Error"); }
        }
        window.deleteHisabItem = function(col, id) { 
    window.confirmDelete('‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?', function() {
        db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection(col).doc(id).delete().then(() => {
            fetchDataFromFirestore();
            alert("Removed!");
        });
    });
}
        window.payHisabDPS = function(id) {
    // ‡¶™‡ßÅ‡¶∞‡¶®‡ßã confirm('Pay?') ‡¶è‡¶∞ ‡¶¨‡¶¶‡¶≤‡ßá ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞
    window.confirmDelete('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ‡¶ï‡¶ø‡¶∏‡ßç‡¶§‡¶ø‡¶ü‡¶ø ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®?', function() {
        const d = dpsData.find(x => x.id === id);
        if (!d) return;

        let next = new Date(d.nextDate);
        next.setMonth(next.getMonth() + 1);

        db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('dps_schemes').doc(id).update({
            paid: parseFloat(d.paid) + parseFloat(d.monthly),
            nextDate: next.toISOString().split('T')[0]
        }).then(() => {
            fetchDataFromFirestore();
            alert("‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‚úÖ");
        }).catch(err => {
            alert("‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: " + err.message);
        });
    });
}

        // --- BOT LOGIC (ULTIMATE FIX) ---
        const chatbotTrigger = document.getElementById('chatbot-trigger'); const chatbotContainer = document.getElementById('chatbot-container'); const closeChatBtn = document.getElementById('close-chat'); const chatInput = document.getElementById('chat-input'); const chatSendBtn = document.getElementById('chat-send-btn'); const chatMessages = document.getElementById('chat-messages'); const chatImgBtn = document.getElementById('chat-img-btn'); const chatFileInput = document.getElementById('chat-file-input');
        chatbotTrigger.addEventListener('click', () => chatbotContainer.style.display = 'flex'); closeChatBtn.addEventListener('click', () => chatbotContainer.style.display = 'none');
        function addMessage(sender, text) {
    const div = document.createElement('div');
    div.className = `message ${sender}`;
    div.innerHTML = text.replace(/\n/g, '<br>');
    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    // --- ‡¶∏‡ßã‡ßü‡¶æ‡¶á‡¶™ ‡¶≤‡¶ú‡¶ø‡¶ï (‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶Æ‡ßá, ‡¶¨‡¶ü ‡¶°‡¶æ‡¶®‡ßá) ---
    let touchStartX = 0;
    let touchEndX = 0;

    div.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
    }, { passive: true });

    div.addEventListener('touchmove', (e) => {
        let currentX = e.changedTouches[0].screenX;
        let diff = currentX - touchStartX;

        // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶π‡¶≤‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶¨‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶ï‡ßá (Negative diff) ‡¶∏‡¶∞‡¶¨‡ßá
        if (sender === 'user' && diff < 0) {
            div.style.transform = `translateX(${diff}px)`;
        }
        // ‡¶¨‡¶ü‡ßá‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶π‡¶≤‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶°‡¶æ‡¶® ‡¶¶‡¶ø‡¶ï‡ßá (Positive diff) ‡¶∏‡¶∞‡¶¨‡ßá
        if (sender === 'bot' && diff > 0) {
            div.style.transform = `translateX(${diff}px)`;
        }
    }, { passive: true });

    div.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].screenX;
        const swipeDistance = touchEndX - touchStartX;
        const threshold = 100; // ‡ßß‡ß¶‡ß¶ ‡¶™‡¶ø‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶ü‡¶æ‡¶®‡¶≤‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡¶¨‡ßá

        // ‡¶∂‡¶∞‡ßç‡¶§ ‡ßß: ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶ï‡ßá ‡¶∏‡ßã‡ßü‡¶æ‡¶á‡¶™
        if (sender === 'user' && swipeDistance < -threshold) {
            deleteWithEffect(div);
        } 
        // ‡¶∂‡¶∞‡ßç‡¶§ ‡ß®: ‡¶¨‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶è‡¶¨‡¶Ç ‡¶°‡¶æ‡¶® ‡¶¶‡¶ø‡¶ï‡ßá ‡¶∏‡ßã‡ßü‡¶æ‡¶á‡¶™
        else if (sender === 'bot' && swipeDistance > threshold) {
            deleteWithEffect(div);
        } 
        else {
            // ‡¶≠‡ßÅ‡¶≤ ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶≤‡ßç‡¶™ ‡¶ü‡¶æ‡¶®‡¶≤‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡ßü ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ü‡¶∏‡¶¨‡ßá
            div.style.transform = 'translateX(0)';
        }
    }, { passive: true });

    // ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶≠‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡¶π)
    function deleteWithEffect(element) {
        if (window.AppInventor) {
            window.AppInventor.setWebViewString("VIBRATE"); 
        }
        element.classList.add('deleting');
        setTimeout(() => {
            element.remove();
        }, 300);
    }

    return div;
}
        chatSendBtn.addEventListener('click', () => processUserMessage()); chatInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') processUserMessage(); }); 
        
async function processUserMessage() { 
            const text = chatInput.value.trim(); if(!text) return; 
            const lowerText = text.toLowerCase(); chatInput.value = '';
            
           // ‡¶è‡¶á ‡¶¨‡ßç‡¶≤‡¶ï‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞ ‡¶Ø‡ßá ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶°‡¶ó‡ßÅ‡¶≤‡ßã ‡¶•‡¶æ‡¶ï‡¶¨‡ßá, ‡¶∏‡ßá‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¨‡¶æ‡¶¨‡¶≤ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ
if(lowerText === 'tools') {
    document.getElementById('moana-tools-modal').style.display = 'flex';
    return; // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá‡¶á ‡¶∂‡ßá‡¶∑, ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá ‡¶®‡¶æ
}

if(lowerText === 'api setting') {
    document.getElementById('api-settings-modal').style.display = 'flex';
    document.getElementById('api-view-mode').style.display = 'block';
    document.getElementById('api-edit-mode').style.display = 'none';
    fetchApiSettings(); 
    return; // ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶π‡¶æ‡¶á‡¶° ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
}

if(lowerText === 'train on') { 
    document.getElementById('training-modal').style.display = 'flex'; 
    switchTrainView('form'); 
    return; 
}

if(lowerText === 'setting') { 
    document.getElementById('settings-modal').style.display = 'flex'; 
    return; 
}

// ‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶®‡¶æ ‡¶Æ‡¶ø‡¶≤‡¶≤‡ßá ‡¶§‡¶¨‡ßá‡¶á ‡¶≤‡ßá‡¶ñ‡¶æ‡¶ü‡¶ø ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
addMessage('user', text);
            const command = identifyCommand(text); 
            if (!command) { handleGeneralQuery(text); return; }
            try { 
                const args = command.args; 
                switch(command.logicId) {
                    // FINANCE
                    case 'ADD_INCOME': await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('daily_transactions').add({ type: 'inc', amount: parseFloat(args[0]), cat: args.slice(1).join(' ') || 'Chat Added', date: new Date().toISOString().split('T')[0] }); addMessage('bot', `Income Added: ${args[0]}`); refreshHisabAll(); break;
                    case 'ADD_EXPENSE': await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('daily_transactions').add({ type: 'exp', amount: parseFloat(args[0]), cat: args.slice(1).join(' ') || 'Chat Added', date: new Date().toISOString().split('T')[0] }); addMessage('bot', `Expense Added: ${args[0]}`); refreshHisabAll(); break;
                    case 'VIEW_BALANCE': let t = dailyData.reduce((a,x)=>x.type==='inc'?a+x.amount:a-x.amount,0) + bankData.reduce((a,x)=>a+x.balance,0); addMessage('bot', `Net Worth: ‡ß≥ ${t}`); break;
                    case 'VIEW_HISTORY': let h = dailyData.slice(-5).reverse().map(t => `${t.date}: ${t.cat} (${t.type==='inc'?'+':'-'}${t.amount})`).join('<br>'); addMessage('bot', `Last 5:<br>${h}`); break;
                    
                    // BANK
                    case 'NEW_BANK': await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('bank_accounts').add({ name: args[0], num: args[1]||'', balance: parseFloat(args[2]||0), history: [] }); addMessage('bot', `Bank Added: ${args[0]}`); refreshHisabAll(); break;
                    case 'BANK_LIST': addMessage('bot', bankData.map(b => `${b.name}: ‡ß≥ ${b.balance}`).join('<br>')); break;
                    
                    // GOAL & DPS
                    case 'NEW_GOAL': await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('savings_goals').add({ name: args[0], target: parseFloat(args[1]||0), balance: 0 }); addMessage('bot', `Goal Set: ${args[0]}`); refreshHisabAll(); break;
                    case 'GOAL_LIST': addMessage('bot', goalData.map(g => `${g.name}: ‡ß≥ ${g.balance} / ${g.target}`).join('<br>')); break;
                    case 'DPS_LIST': addMessage('bot', dpsData.map(d => `${d.bank}: Paid ‡ß≥ ${d.paid}`).join('<br>')); break;
                    
                    // CONTACTS
                    case 'ADD_CONTACT': const newId = await getNextId('contactCounter'); await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('contacts').doc(String(newId)).set({ name: args[0], phone: [args[1] || ''], email: "", address: "Chat", socialLinks: [], createdAt: firebase.firestore.FieldValue.serverTimestamp() }); addMessage('bot', `Contact Saved: ${args[0]}`); break;
                    case 'SEARCH_CONTACT': const fc = allContacts.filter(c => c.name.toLowerCase().includes(args.join(' ').toLowerCase())); addMessage('bot', fc.length ? fc.map(c => `${c.name}: ${c.phone}`).join('<br>') : 'Not found'); break;
                    case 'SEARCH_ALL': handleGeneralQuery(args.join(' ')); break;
                    
                    // MEDIA UPLOAD
                    case 'ADD_PHOTO': window.switchPage('add-info'); document.getElementById('info-category').value='photo'; document.getElementById('info-category').dispatchEvent(new Event('change')); chatbotContainer.style.display='none'; break;
                    case 'ADD_VIDEO': window.switchPage('add-info'); document.getElementById('info-category').value='video'; document.getElementById('info-category').dispatchEvent(new Event('change')); chatbotContainer.style.display='none'; break;
                    case 'ADD_AUDIO': window.switchPage('add-info'); document.getElementById('info-category').value='audio'; document.getElementById('info-category').dispatchEvent(new Event('change')); chatbotContainer.style.display='none'; break;
                    case 'ADD_FILE': window.switchPage('add-info'); document.getElementById('info-category').value='file'; document.getElementById('info-category').dispatchEvent(new Event('change')); chatbotContainer.style.display='none'; break;
                    case 'ADD_LINK': window.switchPage('add-info'); document.getElementById('info-category').value='link'; document.getElementById('info-category').dispatchEvent(new Event('change')); chatbotContainer.style.display='none'; break;
                    case 'ADD_INFO': window.switchPage('add-info'); document.getElementById('info-category').value='text'; document.getElementById('info-category').dispatchEvent(new Event('change')); chatbotContainer.style.display='none'; break;

                    // TOOLS
                    case 'GEN_IMAGE': const loadImgMsg = addMessage('bot', 'Painting...'); const seed = Math.floor(Math.random()*10000); const imgUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(args[0])}?seed=${seed}&width=512&height=512&nologo=true`; const imgObj = new Image(); imgObj.src = imgUrl; imgObj.onload = () => { loadImgMsg.remove(); addMessage('bot', `<img src="${imgUrl}" style="width:200px; border-radius:10px;"><br><a href="${imgUrl}" download class="btn" style="display:inline-block; margin-top:5px; padding:5px 10px; font-size:0.8rem;">Download HD</a>`); }; break;
                    case 'QR_OPTIONS': addMessage('bot', `Select option:<br><button class="chat-opt-btn" onclick="window.triggerQrFile()">Upload QR</button>`); break;
                    case 'GEN_QR': const qrText = args.join(' '); if(!qrText) { addMessage('bot', "Please provide text."); break; } const loadingMsg = addMessage('bot', "Generating..."); setTimeout(() => { loadingMsg.remove(); const qrId = "qr-" + Date.now(); const div = document.createElement('div'); div.className = 'message bot'; div.innerHTML = ` <div style="background:white; padding:10px; margin-top:5px; border-radius:8px; display:inline-block;"> <div id="${qrId}"></div> </div> <div style="font-size:0.7rem; color:#ccc; margin-top:5px; word-break:break-all;">${qrText}</div> <button class="chat-opt-btn" onclick="window.downloadQRCode('${qrId}')" style="margin-top:10px; width:100%; background:var(--success); color:black; font-weight:bold;"> <i class="fas fa-download"></i> Download QR </button> `; chatMessages.appendChild(div); new QRCode(document.getElementById(qrId), { text: qrText, width: 150, height: 150 }); chatMessages.scrollTop = chatMessages.scrollHeight; }, 300); break;
                    case 'DROPBOX_CONVERT': let link = args[0].replace('www.dropbox.com', 'dl.dropboxusercontent.com').replace('dropbox.com', 'dl.dropboxusercontent.com'); addMessage('bot', `üöÄ <b>Direct Link:</b><br><a href="${link}" target="_blank" style="color:#00ff88; word-break:break-all;">${link}</a><br><button onclick="navigator.clipboard.writeText('${link}');alert('Copied!')" class="chat-opt-btn" style="margin-top:5px;">Copy</button>`); break;
                    
                    case 'TRAIN_ON': document.getElementById('training-modal').style.display = 'flex'; switchTrainView('form'); break;
                    case 'OPEN_SETTINGS': document.getElementById('settings-modal').style.display = 'flex'; break;
                    
                    default: addMessage('bot', `Processing ${command.logicId}...`);
            } } catch(e) { addMessage('bot', "Error executing command."); console.log(e); }
        }
        
        function identifyCommand(text) { 
            const lower = text.toLowerCase(); 
            const customMatch = customSettings.find(s => lower.startsWith(s.command.toLowerCase())); 
            if(customMatch) {
                // Fix for arg splitting based on custom command length
                const cmdParts = customMatch.command.split(' ').length;
                return { logicId: customMatch.logicId, args: text.split(' ').slice(cmdParts) };
            }
            if (lower.startsWith('draw ') || lower.startsWith('imagine ') || lower.startsWith('chobi ')) return { logicId: 'GEN_IMAGE', args: [text.replace(/^(draw|imagine|chobi)\s+/i, '').trim()] };
            if(lower.startsWith('add income')) return { logicId: 'ADD_INCOME', args: text.split(' ').slice(2) };
            if(lower.startsWith('add expense')) return { logicId: 'ADD_EXPENSE', args: text.split(' ').slice(2) };
            if(lower.includes('balance')) return { logicId: 'VIEW_BALANCE', args: [] };
            if(lower.includes('history')) return { logicId: 'VIEW_HISTORY', args: [] };
            if(lower.startsWith('add contact')) return { logicId: 'ADD_CONTACT', args: text.split(' ').slice(2) };
            if(lower.includes('upload photo') || lower.includes('add photo')) return { logicId: 'ADD_PHOTO', args: [] };
            if(lower.includes('upload video') || lower.includes('add video')) return { logicId: 'ADD_VIDEO', args: [] };
            if(lower.includes('upload audio') || lower.includes('add music')) return { logicId: 'ADD_AUDIO', args: [] };
            if(lower.includes('upload file') || lower.includes('add file')) return { logicId: 'ADD_FILE', args: [] };
            if (lower.includes('qr scan') || lower.includes('scan qr')) return { logicId: 'QR_OPTIONS', args: [] };
            if (lower.startsWith('make qr ') || lower.startsWith('gen qr ')) return { logicId: 'GEN_QR', args: [text.replace(/^(make|gen)\s+qr\s+/i, '').trim()] };
            if (lower.includes('dropbox.com')) return { logicId: 'DROPBOX_CONVERT', args: [text.replace(/^dropbox\s+/i, '').trim()] };
            return null;
        }
        
        function handleGeneralQuery(text) { const typingDiv = document.createElement('div'); typingDiv.className = 'message bot'; typingDiv.innerHTML = '...'; chatMessages.appendChild(typingDiv); setTimeout(() => { chatMessages.removeChild(typingDiv); const customMatch = customBotData.find(data => text.toLowerCase().includes(data.keyword)); if(customMatch) addMessage('bot', customMatch.reply); else { const m = allInformation.filter(i => i.title.toLowerCase().includes(text.toLowerCase())); if(m.length) addMessage('bot', m.map(i=>i.title).join('<br>')); else addMessage('bot', "No info found."); } }, 500); }
        window.saveCommandSetting = async function() { const logic = document.getElementById('setting-logic-select').value; const cmd = document.getElementById('setting-custom-cmd').value.trim(); if(!logic || !cmd) return alert("Select logic and type command."); const existing = customSettings.find(s => s.logicId === logic); if(existing) { await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('bot_settings').doc(existing.id).update({ command: cmd }); } else { await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('bot_settings').add({ logicId: logic, command: cmd }); } alert("Command Set!"); document.getElementById('setting-custom-cmd').value = ''; }
        // Line 766 ‡¶è‡¶∞ ‡¶Ü‡¶∂‡ßá‡¶™‡¶æ‡¶∂‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®
window.deleteCommandSetting = async function(id) {
    window.confirmDelete("Remove this command?", function() {
        db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('bot_settings').doc(id).delete();
    });
}
        window.editCommandSetting = function(id) { const s = customSettings.find(x => x.id === id); if(!s) return; document.getElementById('setting-logic-select').value = s.logicId; document.getElementById('setting-custom-cmd').value = s.command; document.getElementById('setting-custom-cmd').focus(); }
        function renderSettingsList() { const container = document.getElementById('settings-list-container'); container.innerHTML = ''; customSettings.forEach(s => { container.innerHTML += `<div class="setting-row"><div><span class="logic-tag">${s.logicId}</span><br><b>"${s.command}"</b></div><div style="display:flex;gap:10px;"><button onclick="editCommandSetting('${s.id}')" class="edit-btn"><i class="fas fa-edit"></i></button><button onclick="deleteCommandSetting('${s.id}')" class="delete-btn"><i class="fas fa-trash"></i></button></div></div>`; }); }

        // --- IMAGE HANDLER ---
        let pendingImage = null; chatImgBtn.addEventListener('click', () => chatFileInput.click()); chatFileInput.addEventListener('change', (e) => { const file = e.target.files[0]; if (!file) return; pendingImage = file; const url = URL.createObjectURL(file); const tempImg = new Image();
            tempImg.src = url;
            tempImg.onload = () => URL.revokeObjectURL(url); addMessage('user', `<img src="${url}" style="width:100px;border-radius:5px;">`); addMessage('bot', `<div style="display:flex;gap:5px;"><button class="chat-opt-btn" onclick="window.processScanText()">Scan Text</button><button class="chat-opt-btn" onclick="window.processGetLink()">Get Link</button></div>`); chatFileInput.value = ''; });
        window.processScanText = async function() { if (!pendingImage) return; const loadingMsg = addMessage('bot', 'Scanning...'); try { const processedImage = await preprocessImage(pendingImage); const { data: { text } } = await Tesseract.recognize(processedImage, 'eng'); loadingMsg.remove(); addMessage('bot', text ? `<div style="background:rgba(255,255,255,0.1);padding:5px;">${text}</div><button onclick="navigator.clipboard.writeText('${text.replace(/'/g, "\\'")}')" class="btn-mini">Copy</button>` : "No text."); } catch(e) { loadingMsg.remove(); addMessage('bot', "Scan Error"); } pendingImage = null; }
        window.processGetLink = async function() { if (!pendingImage) return; const loadingMsg = addMessage('bot', 'Uploading...'); const fd = new FormData(); fd.append("image", pendingImage); try { const res = await fetch(`https://api.imgbb.com/1/upload?key=d685822691566e39accb630d6ef7a6d9`, { method: "POST", body: fd }); const d = await res.json(); loadingMsg.remove(); if (d.success) addMessage('bot', `Link: ${d.data.url}<br><button onclick="navigator.clipboard.writeText('${d.data.url}')" class="btn-mini">Copy</button>`); else addMessage('bot', "Failed."); } catch(e) { loadingMsg.remove(); addMessage('bot', "Error."); } pendingImage = null; }
        function preprocessImage(file) { return new Promise((resolve) => { const img = new Image(); img.src = URL.createObjectURL(file); img.onload = () => { const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d'); canvas.width = img.width; canvas.height = img.height; ctx.drawImage(img, 0, 0); resolve(canvas.toDataURL()); }; }); }

        // --- THEME STORE (FIXED: HTML/Script Injection) ---
        window.addEventListener('load', () => { const activeThemeId = localStorage.getItem('activeThemeId'); if (activeThemeId) { applyThemeById(activeThemeId, false); } loadThemeStoreUI(); });
        document.getElementById('theme-upload-input').addEventListener('change', function(e) { const file = e.target.files[0]; if (!file) return; const name = prompt("Theme Name:", file.name.replace('.html','')); if(!name) return; const reader = new FileReader(); reader.onload = function(e) { saveNewTheme(name, e.target.result); }; reader.readAsText(file); e.target.value=''; });
        function saveNewTheme(name, content) { let store = JSON.parse(localStorage.getItem('myThemeStore') || '[]'); const newId = Date.now().toString(); store.push({ id: newId, name: name, content: content, date: new Date().toLocaleDateString() }); localStorage.setItem('myThemeStore', JSON.stringify(store)); loadThemeStoreUI(); applyThemeById(newId); }
        function loadThemeStoreUI() { const list = document.getElementById('theme-store-list'); const store = JSON.parse(localStorage.getItem('myThemeStore') || '[]'); const activeId = localStorage.getItem('activeThemeId'); list.innerHTML = ''; if (store.length === 0) { list.innerHTML = '<div style="text-align: center; color: #666; font-size: 0.8rem; padding: 10px;">No themes saved yet. Import one!</div>'; return; } store.forEach(t => { const isActive = t.id === activeId; let statusHtml = isActive ? `<div class="badge-active"><i class="fas fa-check-circle"></i> Active</div>` : `<button class="btn-mini btn-apply" onclick="applyThemeById('${t.id}')">Apply</button>`; list.innerHTML += `<div class="theme-item" style="${isActive ? 'border-color: var(--success); box-shadow: 0 0 10px rgba(16,185,129,0.1);' : ''}"><div class="theme-name">${t.name}</div><div class="theme-actions"><button class="btn-mini btn-download" onclick="downloadTheme('${t.id}')"><i class="fas fa-download"></i></button>${statusHtml}<button class="btn-mini btn-delete" onclick="deleteTheme('${t.id}')"><i class="fas fa-trash"></i></button></div></div>`; }); }
        window.downloadTheme = function(id) { const store = JSON.parse(localStorage.getItem('myThemeStore') || '[]'); const theme = store.find(t => t.id === id); if (!theme) return; const blob = new Blob([theme.content], { type: 'text/html' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = `${theme.name}.html`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); }
        
        // ** CRITICAL FIX: Proper Theme Injection **
        function injectThemeCSS(htmlContent) {
            const bgLayer = document.getElementById('theme-bg-layer'); const styleTag = document.getElementById('theme-custom-style');
            // CSS Injection
            const styleMatch = htmlContent.match(/<style[^>]*>([\s\S]*?)<\/style>/i);
            if (styleMatch && styleMatch[1]) { let css = styleMatch[1].replace(/body\s*{/g, '#theme-bg-layer {').replace(/html\s*{/g, ''); styleTag.innerHTML = css; }
            // Body Content Injection
            const bodyMatch = htmlContent.match(/<body[^>]*>([\s\S]*?)<\/body>/i);
            if (bodyMatch && bodyMatch[1]) { let bodyHtml = bodyMatch[1].replace(/<script\b[^>]*>([\s\S]*?)<\/script>/gim, ""); bgLayer.innerHTML = bodyHtml; }
            // Script Injection
            const scriptMatch = htmlContent.matchAll(/<script\b[^>]*>([\s\S]*?)<\/script>/gim);
            for (const match of scriptMatch) { if (match[1]) { const newScript = document.createElement("script"); newScript.textContent = match[1]; document.body.appendChild(newScript); } }
        }

 // --- THEME FUNCTIONS (FIXED) ---
window.applyThemeById = function(id, alertUser=true) { 
    const store = JSON.parse(localStorage.getItem('myThemeStore') || '[]'); 
    const t = store.find(x => x.id === id); 
    if(t) { 
        injectThemeCSS(t.content); 
        localStorage.setItem('activeThemeId', id); 
        loadThemeStoreUI(); 
        if(alertUser) alert("Theme Applied! ‚úÖ"); 
    } 
}

window.deleteTheme = function(id) {
    window.confirmDelete('‡¶è‡¶á ‡¶•‡¶ø‡¶Æ‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?', function() {
        let store = JSON.parse(localStorage.getItem('myThemeStore') || '[]'); 
        store = store.filter(t => t.id !== id); 
        localStorage.setItem('myThemeStore', JSON.stringify(store)); 
        if(localStorage.getItem('activeThemeId') === id) {
            resetToDefaultTheme(); 
        } else {
            loadThemeStoreUI();
        }
        alert("Theme Deleted!");
    });
}

window.resetToDefaultTheme = function() { 
    localStorage.removeItem('activeThemeId'); 
    document.getElementById('theme-custom-style').innerHTML = ''; 
    document.getElementById('theme-bg-layer').innerHTML = ''; 
    location.reload(); 
}

// ABOUT MODAL
const aboutBtn = document.getElementById('about-btn'); 
const aboutModal = document.getElementById('about-modal');
if(aboutBtn) { 
    aboutBtn.addEventListener('click', function() { 
        const user = auth.currentUser; 
        if(user) { 
            document.getElementById('about-user-email').textContent = user.email; 
        } 
        aboutModal.style.display = 'flex'; 
    }); 
}
window.addEventListener('click', function(e) { 
    if (e.target === aboutModal) { 
        aboutModal.style.display = 'none'; 
    } 
});

    // QR LOGIC (ONLY UPLOAD - NO CAMERA)
    window.triggerQrFile = function() {
        document.getElementById('qr-file-input').click();
    }

    const qrInput = document.getElementById('qr-file-input');
    if(qrInput) {
        qrInput.addEventListener('change', async e => {
            const file = e.target.files[0];
            if (!file) return;

            if(typeof addMessage === "function") addMessage('bot', 'Scanning image...');

            try {
                // ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤‡¶æ‡¶á‡¶ú (reader div ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã ‡¶•‡¶æ‡¶ï‡¶¨‡ßá)
                const fileScanner = new Html5Qrcode("reader");
                const decodedText = await fileScanner.scanFile(file, true);
                
                // ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                if(typeof addMessage === "function") {
                    addMessage('bot', `‚úÖ <b>QR Found:</b><br><span style="color:#00ff88; word-break:break-all;">${decodedText}</span><br><button onclick="navigator.clipboard.writeText('${decodedText}');alert('Copied!')" class="btn-mini" style="margin-top:5px;">Copy</button> <a href="${decodedText}" target="_blank" class="btn-mini">Open</a>`);
                } else {
                    alert("QR Found: " + decodedText);
                }
                fileScanner.clear(); // ‡¶Æ‡ßá‡¶Æ‡ßã‡¶∞‡¶ø ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞
            } catch (err) {
                console.log(err);
                if(typeof addMessage === "function") {
                    addMessage('bot', "‚ùå QR Code not found. Try a clear image.");
                } else {
                    alert("QR Code not found!");
                }
            }
            e.target.value = ''; // ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü
        });
    }

    // ‡ß™. ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    window.handleQrResult = function(text) {
        window.stopQrScanner();
        if(typeof addMessage === "function") {
            addMessage('bot', `‚úÖ <b>QR Found:</b><br><span style="color:#00ff88; word-break:break-all;">${text}</span><br><button onclick="navigator.clipboard.writeText('${text}');alert('Copied!')" class="btn-mini" style="margin-top:5px;">Copy</button> <a href="${text}" target="_blank" class="btn-mini">Open</a>`);
        } else {
            alert("QR Found: " + text);
        }
    }

    // ‡ß´. ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ
    window.stopQrScanner = function() {
        document.getElementById('qr-modal').style.display = 'none';
        if (html5QrCode) {
            html5QrCode.stop().then(() => {
                html5QrCode.clear();
            }).catch(err => console.log("Stop failed", err));
        }
    }
    });
// --- ‡¶∏‡¶¨ ‡¶´‡¶ø‡¶ô‡ßç‡¶ó‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶è‡¶ñ‡¶® ‡¶è‡¶ï‡¶ü‡¶ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡ßá (‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶ø‡¶§) ---
function onFingerprintSuccess() {
    const lockScreen = document.getElementById('app-lock-screen');
    const apiModal = document.getElementById('api-settings-modal');
    
    // ‡ßß. ‡¶Ø‡¶¶‡¶ø ‡¶Æ‡ßá‡¶á‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡¶ï (PIN Screen) ‡¶∏‡¶æ‡¶Æ‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡ßá
    if (lockScreen && lockScreen.style.display === 'flex') {
        lockScreen.style.display = 'none';
        document.getElementById('app-pin-input').value = '';
        alert("System Unlocked! ‚úÖ");
        return; // ‡¶ï‡¶æ‡¶ú ‡¶∂‡ßá‡¶∑, ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡ßá‡¶∞ ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
    } 
    
    // ‡ß®. ‡¶Ø‡¶¶‡¶ø ‡¶è‡¶™‡¶ø‡¶Ü‡¶á ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã ‡¶ì‡¶™‡ßá‡¶® ‡¶•‡¶æ‡¶ï‡ßá
    if (apiModal && apiModal.style.display === 'flex') {
        openApiEdit(); // ‡¶è‡¶°‡¶ø‡¶ü ‡¶Æ‡ßã‡¶° ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡¶¨‡ßá
        return; // ‡¶ï‡¶æ‡¶ú ‡¶∂‡ßá‡¶∑, ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡ßá‡¶∞ ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
    }
    
    // ‡ß©. ‡¶Ø‡¶¶‡¶ø ‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã‡¶ü‡¶ø‡¶á ‡¶®‡¶æ ‡¶π‡ßü, ‡¶§‡¶¨‡ßá ‡¶è‡¶ü‡¶ø ‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡ßá‡¶ú ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá
    const savedEmail = localStorage.getItem('savedEmail');
    const savedPass = localStorage.getItem('savedPass');
    if (savedEmail && savedPass) {
        document.getElementById('login-error').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
        auth.signInWithEmailAndPassword(savedEmail, savedPass).catch(() => {
            document.getElementById('login-error').textContent = 'Login Failed.';
        });
    } else {
        alert("Please login with Password once to enable Biometric.");
    }
}
function onFingerprintError(errorMessage) {
    // ‡¶´‡¶ø‡¶ô‡ßç‡¶ó‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶®‡¶æ ‡¶Æ‡¶ø‡¶≤‡¶≤‡ßá ‡¶¨‡¶æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶∏‡ßá‡¶≤ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶è‡¶ü‡¶ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá
    console.log("Biometric Failed: " + errorMessage);
    document.getElementById('login-error').textContent = 'Fingerprint mismatch.';
}
// --- GLOBAL KEYBOARD & INPUT FOCUS FIX ---
document.querySelectorAll('input, textarea').forEach(element => {
    element.addEventListener('focus', function() {
        // ‡ßß. ‡¶Ø‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ï‡ßç‡¶∏‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∏‡ßá‡¶ü‡¶ø ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ù‡¶ñ‡¶æ‡¶®‡ßá ‡¶ö‡¶≤‡ßá ‡¶Ü‡¶∏‡¶¨‡ßá (‡¶ï‡¶ø‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶¢‡¶æ‡¶ï‡¶æ ‡¶¶‡ßá‡¶¨‡ßá ‡¶®‡¶æ)
        setTimeout(() => {
            this.scrollIntoView({ behavior: "smooth", block: "center" });
        }, 300);

        // ‡ß®. ‡¶Ø‡¶¶‡¶ø ‡¶è‡¶ü‡¶ø ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡¶¨‡¶ï‡ßç‡¶∏‡ßá‡¶∞ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶π‡ßü, ‡¶§‡¶¨‡ßá ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ ‡¶â‡¶™‡¶∞‡ßá ‡¶§‡ßÅ‡¶≤‡¶¨‡ßá
        if (this.id === 'chat-input' && window.innerWidth < 800) {
            const chatCont = document.getElementById('chatbot-container');
            if(chatCont) {
                chatCont.style.transition = "bottom 0.3s ease";
                chatCont.style.bottom = "380px"; 
            }
        }
    });

    element.addEventListener('blur', function() {
        // ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡¶¨‡¶ï‡ßç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶´‡ßã‡¶ï‡¶æ‡¶∏ ‡¶ö‡¶≤‡ßá ‡¶ó‡ßá‡¶≤‡ßá ‡¶∏‡ßá‡¶ü‡¶ø ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá ‡¶®‡¶æ‡¶Æ‡¶ø‡ßü‡ßá ‡¶¶‡ßá‡¶¨‡ßá
        if (this.id === 'chat-input' && window.innerWidth < 800) {
            const chatCont = document.getElementById('chatbot-container');
            if(chatCont) chatCont.style.bottom = "100px";
        }
    });
});
   // --- CUSTOM ALERT SYSTEM (Removes localhost text) ---
    // 1. Create Styling dynamically
    const alertStyle = document.createElement('style');
    alertStyle.innerHTML = `
        #custom-alert {
            display: none;
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, rgba(23, 28, 44, 0.95), rgba(10, 10, 20, 0.98));
            border: 1px solid var(--primary, #21D4FD);
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            padding: 20px;
            border-radius: 15px;
            z-index: 100000;
            text-align: center;
            min-width: 280px;
            backdrop-filter: blur(10px);
        }
        #custom-alert p {
            color: #fff; margin-bottom: 20px; font-size: 1rem;
        }
        #custom-alert button {
            background: var(--primary, #21D4FD);
            color: #000; border: none;
            padding: 8px 25px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
        }
        #alert-overlay {
            display: none;
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 99999;
        }
    `;
    document.head.appendChild(alertStyle);

    // 2. Create HTML Elements
    const overlay = document.createElement('div');
    overlay.id = 'alert-overlay';
    document.body.appendChild(overlay);

    const alertBox = document.createElement('div');
    alertBox.id = 'custom-alert';
    alertBox.innerHTML = `<p id="alert-msg"></p><button onclick="closeCustomAlert()">OK</button>`;
    document.body.appendChild(alertBox);

    // 3. Override Default Alert
    window.alert = function(message) {
        document.getElementById('alert-msg').innerText = message;
        document.getElementById('alert-overlay').style.display = 'block';
        document.getElementById('custom-alert').style.display = 'block';
    };

    window.closeCustomAlert = function() {
        document.getElementById('alert-overlay').style.display = 'none';
        document.getElementById('custom-alert').style.display = 'none';
    };
    
    // --- MOANA TOOLS LOGIC ---

// ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡¶¨‡¶ü ‡¶¶‡¶ø‡ßü‡ßá ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶°
function checkMoanaCommand(text) {
    if(text.toLowerCase() === 'tools') {
        document.getElementById('moana-tools-modal').style.display = 'flex';
        addMessage('bot', "Moana Tools The window is opened.");
        return true;
    }
    return false;
}

// Tab Switching
function switchMoanaTab(type) {
    const wordSec = document.getElementById('moana-word-sec');
    const emailSec = document.getElementById('moana-email-sec');
    const tab1 = document.getElementById('moana-tab-1');
    const tab2 = document.getElementById('moana-tab-2');

    if(type === 'word') {
        wordSec.style.display = 'block';
        emailSec.style.display = 'none';
        tab1.style.background = '#0077be'; tab1.style.color = 'white';
        tab2.style.background = 'none'; tab2.style.color = '#005662';
    } else {
        wordSec.style.display = 'none';
        emailSec.style.display = 'block';
        tab2.style.background = '#0077be'; tab2.style.color = 'white';
        tab1.style.background = 'none'; tab1.style.color = '#005662';
    }
}

// Word Counter
document.getElementById('moana-text-input').addEventListener('input', function() {
    const text = this.value.trim();
    document.getElementById('m-char-count').innerText = this.value.length;
    document.getElementById('m-word-count').innerText = text === "" ? 0 : text.split(/\s+/).length;
});

function clearMoanaText() {
    document.getElementById('moana-text-input').value = "";
    document.getElementById('m-char-count').innerText = "0";
    document.getElementById('m-word-count').innerText = "0";
}

// AI Image Scanner
async function moanaScanImage() {
    const file = document.getElementById('moana-img-input').files[0];
    if (!file) return;
    alert("Starting AI scan... Please wait.");
    try {
        const { data: { text } } = await Tesseract.recognize(file, 'eng');
        const emails = text.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)/gi);
        if (emails) {
            document.getElementById('moana-email-list').value = [...new Set(emails)].join('\n');
            alert("Success! Emails extracted.");
        } else {
            alert("No emails found in the image.");
        }
    } catch (e) {
        alert("Scan Error!");
    }
}

// Generate Email Format
function moanaGenerate() {
    const emails = document.getElementById('moana-email-list').value.split('\n');
    const pass = document.getElementById('moana-pass-input').value;
    if(!emails[0] || !pass) return alert("Please enter both emails and password!");
    
    let res = emails.map(e => e.trim() ? `Email: ${e.trim()}\nPassword: ${pass}` : '').filter(x => x).join('\n\n');
    document.getElementById('moana-output').value = res;
}

// Copy to Clipboard
function moanaCopy() {
    const out = document.getElementById('moana-output');
    if(!out.value) return;
    out.select();
    document.execCommand('copy');
    alert("Result copied successfully! ‚úÖ");
}
    let appLockData = null; // ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶∏‡¶æ ‡¶≤‡¶ï ‡¶°‡¶æ‡¶ü‡¶æ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá

function updateLockPlaceholder() {
    const type = document.getElementById('lock-type-select').value;
    const input = document.getElementById('new-app-lock');
    
    // ‡ßß. ‡¶è‡¶á ‡¶≤‡¶æ‡¶á‡¶®‡¶ü‡¶ø ‡¶Æ‡ßã‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶≠‡ßÅ‡¶≤ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶¶‡ßá‡ßü (‡¶ñ‡ßÅ‡¶¨‡¶á ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞‡¶ø)
    input.value = '';

    if(type === 'pin') {
        input.type = "tel"; 
        input.inputMode = "numeric"; 
        input.style.webkitTextSecurity = "disc"; // ‡¶™‡¶ø‡¶® ‡¶°‡¶ü ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
        input.placeholder = "Enter PIN (Digits only)";
    } else {
        input.type = "password"; 
        input.inputMode = "text"; 
        input.style.webkitTextSecurity = "none"; // ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤
        input.placeholder = "Enter Password (6-11 Chars)";
    }
}

// ‡¶è‡¶ü‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡ß® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶® (‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï)
async function saveAppLockSettings() {
    const user = auth.currentUser;
    if(!user) return;
    
    // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ï‡¶ø ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶≤‡ßã (‡¶™‡¶ø‡¶® ‡¶®‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°) ‡¶∏‡ßá‡¶ü‡¶æ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
    const lockType = document.getElementById('lock-type-select').value; 
    const lockVal = document.getElementById('new-app-lock').value.trim();
    
    if(lockType === 'pin') {
        // ‡¶è‡¶á ‡¶≤‡¶æ‡¶á‡¶®‡¶ü‡¶ø ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßá ‡¶≤‡ßá‡¶ñ‡¶æ‡¶ü‡¶ø ‡¶ï‡¶ø ‡¶∂‡ßÅ‡¶ß‡ßÅ "‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ" ‡¶ï‡¶ø ‡¶®‡¶æ
        const isNumeric = /^\d+$/.test(lockVal);
        if(!isNumeric || lockVal.length < 4 || lockVal.length > 11) {
            alert("‡¶≠‡ßÅ‡¶≤: ‡¶™‡¶ø‡¶® ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡ß™ ‡¶•‡ßá‡¶ï‡ßá ‡ßß‡ßß ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!");
            return; // ‡¶≠‡ßÅ‡¶≤ ‡¶π‡¶≤‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá‡¶á ‡¶ï‡¶æ‡¶ú ‡¶•‡ßá‡¶Æ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
        }
    } else {
        // ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶ø‡ßü‡¶Æ ‡¶ö‡ßá‡¶ï
        if(lockVal.length < 6 || lockVal.length > 11) {
            alert("‡¶≠‡ßÅ‡¶≤: ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!");
            return;
        }
    }

    // ‡¶∏‡¶¨ ‡¶†‡¶ø‡¶ï ‡¶•‡¶æ‡¶ï‡¶≤‡ßá Firebase-‡¶è ‡¶∏‡ßá‡¶≠ ‡¶π‡¶¨‡ßá
    try {
        await db.collection('users').doc(user.uid).collection('security').doc('app_lock').set({
            lockValue: lockVal,
            lockType: lockType, // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡¶ø‡¶® ‡¶®‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
            fingerprintEnabled: (appLockData && appLockData.fingerprintEnabled) ? true : false
        });
        alert("Settings Saved Successfully! ‚úÖ");
        document.getElementById('new-app-lock').value = '';
        fetchAppLockSettings(); 
    } catch(e) { alert("Error!"); }
}

// ‡ßß. ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡¶ï ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
async function fetchAppLockSettings() {
    const user = auth.currentUser;
    if(!user) return;
    const doc = await db.collection('users').doc(user.uid).collection('security').doc('app_lock').get();
    if(doc.exists) {
        appLockData = doc.data();
        showLockScreen(); // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶≤‡¶ï ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì
        updateSecurityUI();
    }
}

 // ‡ß®. ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ñ‡ßã‡¶≤‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶ï‡¶ø‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶ì ‡¶™‡¶ø‡¶® ‡¶ó‡ßã‡¶™‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶≤‡¶ú‡¶ø‡¶ï
function showLockScreen() {
    if(!appLockData) return;
    
    const lockScreen = document.getElementById('app-lock-screen');
    const pinInput = document.getElementById('app-pin-input');
    
    lockScreen.style.display = 'flex';
    
    // Kodular/AppInventor ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶´‡¶ø‡¶ô‡ßç‡¶ó‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶ó‡¶®‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
    if(appLockData.fingerprintEnabled && window.AppInventor) {
        window.AppInventor.setWebViewString("SCAN_FINGERPRINT_LOCK"); 
    }

    // ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶≤‡¶ï‡ßá‡¶∞ ‡¶ß‡¶∞‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶ï‡¶ø‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
    if (appLockData.lockType === 'pin') {
        // ‡¶™‡¶ø‡¶® ‡¶Æ‡ßã‡¶°: ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶ï‡¶ø‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶Ü‡¶∏‡¶¨‡ßá
        pinInput.type = "tel"; 
        pinInput.inputMode = "numeric"; 
        
        // CSS ‡¶è‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶≤‡ßá‡¶ñ‡¶æ‡¶ó‡ßÅ‡¶≤‡ßã‡¶ï‡ßá ‡¶°‡¶ü (‚óè) ‡¶è ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞ (Security Fix)
        pinInput.style.webkitTextSecurity = "disc"; 
        pinInput.classList.add('pin-hidden'); 
    } else {
        // ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡ßã‡¶°: ‡¶´‡ßÅ‡¶≤ ‡¶ï‡¶ø‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶Ü‡¶∏‡¶¨‡ßá
        pinInput.type = "password"; 
        pinInput.inputMode = "text"; 
        
        // ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶°‡¶ü ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤
        pinInput.style.webkitTextSecurity = "none"; 
        pinInput.classList.remove('pin-hidden');
    }

    // ‡¶¨‡¶æ‡ßü‡ßã‡¶Æ‡ßá‡¶ü‡ßç‡¶∞‡¶ø‡¶ï ‡¶Ö‡¶™‡¶∂‡¶® ‡¶Ö‡¶® ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶´‡¶ø‡¶ô‡ßç‡¶ó‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
    if(appLockData.fingerprintEnabled) {
        document.getElementById('fingerprint-lock-section').style.display = 'block';
    }
} 

// ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶≤‡¶ú‡¶ø‡¶ï
function unlockApp() {
    const pinInput = document.getElementById('app-pin-input');
    const inputVal = pinInput.value;
    
    if(!appLockData) {
        document.getElementById('app-lock-screen').style.display = 'none';
        return;
    }

    if(inputVal === appLockData.lockValue) {
        document.getElementById('app-lock-screen').style.display = 'none';
        pinInput.value = '';
        // ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶π‡¶≤‡ßá ‡¶∏‡ßá‡¶∂‡¶® ‡¶∏‡ßá‡¶≠ ‡¶∞‡¶æ‡¶ñ‡¶æ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)
        sessionStorage.setItem('appUnlocked', 'true');
    } else {
        alert("Wrong PIN/Password! Enter the correct PIN or use 'Forgot PIN'.");
        pinInput.value = '';
    }
}

// ‡¶´‡¶ø‡¶ô‡ßç‡¶ó‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶≤‡¶ú‡¶ø‡¶ï (Kodular ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
function triggerLockFingerprint() {
    if (window.AppInventor) {
        window.AppInventor.setWebViewString("SCAN_FINGERPRINT_LOCK");
    } else {
        alert("Biometric not available in browser.");
    }
}

// ‡¶¨‡¶æ‡¶Ø‡¶º‡ßã‡¶Æ‡ßá‡¶ü‡ßç‡¶∞‡¶ø‡¶ï ‡¶Ö‡¶®-‡¶Ö‡¶´ ‡¶ü‡¶ó‡¶≤
async function toggleBiometric() {
    const user = auth.currentUser;
    if(!appLockData) return alert("Set PIN first!");
    const newState = !appLockData.fingerprintEnabled;
    await db.collection('users').doc(user.uid).collection('security').doc('app_lock').update({
        fingerprintEnabled: newState
    });
    appLockData.fingerprintEnabled = newState;
    updateSecurityUI();
}

function updateSecurityUI() {
    const btn = document.getElementById('toggle-biometric-btn');
    if(appLockData.fingerprintEnabled) {
        btn.innerText = "Fingerprint: ON";
        btn.style.background = "var(--primary)";
    } else {
        btn.innerText = "Fingerprint: OFF";
        btn.style.background = "#444";
    }
}
// ‡ßß. ‡¶è‡¶°‡¶ø‡¶ü ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶è‡¶ü‡¶ø ‡¶∞‡¶æ‡¶® ‡¶π‡¶¨‡ßá
function requestAuthForApi() {
    if (window.AppInventor) {
        // ‡¶ï‡ßã‡¶°‡ßÅ‡¶≤‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶´‡¶ø‡¶ô‡ßç‡¶ó‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶ó‡¶®‡ßç‡¶Ø‡¶æ‡¶≤
        window.AppInventor.setWebViewString("SCAN_FINGERPRINT_FOR_API");
    } else {
        // ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â‡¶§‡ßá ‡¶Æ‡¶°‡¶æ‡¶∞‡ßç‡¶® ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
        document.getElementById('api-auth-modal').style.display = 'flex';
        document.getElementById('api-auth-input').value = ''; // ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá
        document.getElementById('api-auth-input').focus();
    }
}

// ‡ß®. ‡¶Æ‡¶°‡¶æ‡¶∞‡ßç‡¶® ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡¶ø‡¶® ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
function verifyApiAuth() {
    const enteredPin = document.getElementById('api-auth-input').value;
    
    // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶™‡¶ø‡¶® ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶¨‡ßá
    if(enteredPin === appLockData.lockValue) {
        document.getElementById('api-auth-modal').style.display = 'none';
        openApiEdit(); // ‡¶™‡¶ø‡¶® ‡¶Æ‡¶ø‡¶≤‡¶≤‡ßá ‡¶è‡¶°‡¶ø‡¶ü ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã ‡¶ñ‡ßÅ‡¶≤‡¶¨‡ßá
    } else {
        alert("‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶ø‡¶®! ‚ùå");
        document.getElementById('api-auth-input').value = '';
    }
}

// ‡ß®. ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡¶æ
function openApiEdit() {
    document.getElementById('api-view-mode').style.display = 'none';
    document.getElementById('api-edit-mode').style.display = 'block';
    document.getElementById('new-bot-token').value = TG_BOT_TOKEN;
    document.getElementById('new-chat-id').value = TG_CHAT_ID;
}

// ‡ß©. ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶™‡¶ø‡¶Ü‡¶á ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
async function saveApiSettings() {
    const newToken = document.getElementById('new-bot-token').value.trim();
    const newId = document.getElementById('new-chat-id').value.trim();
    
    if(!newToken || !newId) return alert("‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ò‡¶∞ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!");

    try {
        await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('config').doc('telegram_api').set({
            token: newToken,
            chatId: newId
        });
        
        alert("API ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶∞‡¶ø‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...");
        location.reload(); 
    } catch(e) {
        alert("‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: " + e.message);
    }
}



function closeApiEdit() {
    document.getElementById('api-view-mode').style.display = 'block';
    document.getElementById('api-edit-mode').style.display = 'none';
}


// ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßã‡¶°‡ßá‡¶∞ ‡¶è‡¶ï‡¶¶‡¶Æ ‡¶®‡¶ø‡¶ö‡ßá ‡¶è‡¶ü‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®
setTimeout(() => {
    if(document.getElementById('app-lock-screen').style.display === 'flex') {
        if(window.AppInventor) {
            window.AppInventor.setWebViewString("SCAN_FINGERPRINT_LOCK");
        }
    }
}, 1500); // ‡ßß.‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶∏‡ßá‡¶®‡ßç‡¶∏‡¶∞ ‡¶ö‡¶æ‡¶á‡¶¨‡ßá
// ‡¶è‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ HTML ‡¶è‡¶∞ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶®‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
window.showApiPinModal = function() {
    // API ‡¶™‡¶ø‡¶® ‡¶¶‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
    const apiModal = document.getElementById('api-auth-modal');
    if (apiModal) {
        apiModal.style.display = 'flex';
        document.getElementById('api-auth-input').value = '';
        document.getElementById('api-auth-input').focus();
    }
};
let confirmCallback = null;

// ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶¨‡¶ï‡ßç‡¶∏‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡ßá ‡¶è‡¶ü‡¶ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá
window.confirmDelete = function(message, callback) {
    document.getElementById('confirm-msg').innerText = message;
    document.getElementById('custom-confirm-overlay').style.display = 'block';
    confirmCallback = callback;
}

window.closeConfirm = function(result) {
    document.getElementById('custom-confirm-overlay').style.display = 'none';
    if(result && confirmCallback) {
        confirmCallback();
    }
}
// ‡ßß. ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶ì‡¶™‡ßá‡¶® ‡¶π‡¶¨‡ßá

let tempShareData = {}; 

window.shareInformation = function(id, isContact = false) {
    const modal = document.getElementById('share-pass-modal');
    const input = document.getElementById('set-share-password');
    const confirmBtn = document.getElementById('final-share-btn');
    
    tempShareData = { id, isContact };
    input.value = ""; 
    modal.style.display = 'flex';
    input.focus();

    confirmBtn.onclick = () => executeFinalShare();
}

async function executeFinalShare() {
    const pass = document.getElementById('set-share-password').value.trim();
    const btn = document.getElementById('final-share-btn');
    const { id, isContact } = tempShareData;
    const collectionName = isContact ? 'contacts' : 'informations';

    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
    btn.disabled = true;

    try {
        const expiryTimestamp = Date.now() + (24 * 60 * 60 * 1000); 
        await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection(collectionName).doc(id).update({
            sharePassword: pass || null,
            expiresAt: expiryTimestamp,
            isShared: true 
        });

        const longUrl = `${window.location.origin}${window.location.pathname}?view=${id}&type=${isContact ? 'contact' : 'info'}`;
        let finalLink = longUrl; 

        try {
            const shortRes = await fetch(`https://tinyurl.com/api-create.php?url=${encodeURIComponent(longUrl)}`);
            if (shortRes.ok) {
                const shortUrl = await shortRes.text();
                if (shortUrl && shortUrl.includes("tinyurl.com")) finalLink = shortUrl;
            }
        } catch (e) { console.log("Shortener busy, using long URL."); }

        if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(finalLink);
        } else {
            const textArea = document.createElement("textarea");
            textArea.value = finalLink;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
        }

        document.getElementById('share-pass-modal').style.display = 'none';
        const msg = finalLink.includes("tinyurl") ? "Short Link Copied! üöÄ" : "Link Copied! (Long URL) üöÄ";
        alert(`${msg}\n\nURL: ${finalLink}`);

    } catch (err) {
        alert("Error: ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
    } finally {
        btn.innerHTML = "GENERATE LINK";
        btn.disabled = false;
    }
}

// ‡ß®. ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶≤‡ßá ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
window.addEventListener('load', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const sharedId = urlParams.get('view');

    if (sharedId) {
        if(document.getElementById('loading-screen')) document.getElementById('loading-screen').style.display = 'none';
        document.getElementById('login-page').style.display = 'none';
        if(document.getElementById('admin-panel')) document.getElementById('admin-panel').style.display = 'none';
        document.getElementById('public-share-view').style.display = 'block';
        loadUniversalData(sharedId);
    }
});

// ‡ß©. ‡¶á‡¶â‡¶®‡¶ø‡¶´‡¶æ‡¶á‡¶° ‡¶≤‡ßã‡¶°‡¶æ‡¶∞
async function loadUniversalData(id) {
    const area = document.getElementById('share-content-area');
    const expireScreen = document.getElementById('expire-screen');
    const passScreen = document.getElementById('password-screen');
    
    const urlParams = new URLSearchParams(window.location.search);
    const type = urlParams.get('type') || 'info'; 
    const collectionName = type === 'contact' ? 'contacts' : 'informations';

    try {
        const doc = await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection(collectionName).doc(id).get();
        if (!doc.exists) {
            area.style.display = 'block';
            area.innerHTML = "<h2 style='text-align:center; padding:50px;'>Data not found.!</h2>";
            return;
        }

        currentSharedData = { id: doc.id, ...doc.data() };
        const now = Date.now();
        if (currentSharedData.expiresAt && now > currentSharedData.expiresAt) {
            expireScreen.style.display = 'block';
            area.style.display = 'none';
            passScreen.style.display = 'none';
            return; 
        }

        if (currentSharedData.sharePassword) {
            area.style.display = 'none';
            passScreen.style.display = 'block';
        } else {
            area.style.display = 'block';
            renderSharedContent();
        }
    } catch (e) {
        area.style.display = 'block';
        area.innerHTML = "<h2>Loading error!</h2>";
    }
}

function verifySharePassword() {
    const inputPass = document.getElementById('share-pass-input').value;
    if (inputPass === currentSharedData.sharePassword) {
        document.getElementById('password-screen').style.display = 'none';
        document.getElementById('share-content-area').style.display = 'block';
        renderSharedContent();
    } else {
        alert("Wrong password! ");
    }
}

// ‡ß™. ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
async function renderSharedContent() {
    const area = document.getElementById('share-content-area');
    const data = currentSharedData;
    area.innerHTML = '<div style="text-align:center;"><i class="fas fa-spinner fa-spin"></i> Loading...</div>';
    let html = "";

    try {
        if (data.phone) {
            html = `
                <div style="text-align:center; margin-bottom:20px;">
                    <div style="width:70px; height:70px; background:var(--primary); color:black; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 15px; font-size:1.8rem;"><i class="fas fa-user"></i></div>
                    <h2 style="margin-bottom:5px;">${data.name}</h2>
                    <p style="color:#aaa; font-size:0.8rem;">Contact Card</p>
                </div>
                <div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:15px; border:1px solid rgba(255,255,255,0.1);">
                    <small style="color:var(--primary); font-weight:bold;">Phone number:</small>
                    <div style="font-size:1.2rem; margin-bottom:15px; margin-top:5px;">${data.phone.join('<br>')}</div>
                    ${data.email ? `<small style="color:var(--primary); font-weight:bold;">Email:</small><div>${data.email}</div>` : ''}
                    ${data.address ? `<small style="color:var(--primary); font-weight:bold;">Address:</small><div>${data.address}</div>` : ''}
                </div>
                <div style="margin-top:25px; text-align:center;"><a href="tel:${data.phone[0]}" class="btn" style="background:var(--success); color:black; font-weight:bold; padding:12px 40px; border-radius:50px; display:inline-block; text-decoration:none;"> Call Now</a></div>`;
        } else {
            html = `<div style="text-align:center; margin-bottom:20px;"><span style="background:var(--primary); color:black; padding:2px 8px; border-radius:5px; font-size:0.7rem; font-weight:bold; text-transform:uppercase;">${data.category}</span></div><h2 style="text-align:center; margin-bottom:25px;">${data.title}</h2>`;
            if (data.category === 'text') html += `<div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:15px; white-space:pre-wrap;">${data.fullContent}</div>`;
            else if (data.category === 'link') html += `<div style="text-align:center; background:rgba(255,255,255,0.05); padding:20px; border-radius:15px;"><p style="word-break:break-all; color:#aaa; margin-bottom:15px;">${data.fullContent}</p><a href="${data.fullContent}" target="_blank" class="btn" style="background:var(--secondary); color:white; width:auto; padding:10px 30px;">Open link</a></div>`;
            else if (data.category === 'mail') {
                data.fullContent.split('|||').forEach((acc, idx) => {
                    const [e, p] = acc.split(' | Password: ').map(s => s.replace('Email: ', ''));
                    html += `<div style="background:rgba(0,0,0,0.3); padding:15px; border-radius:12px; margin-bottom:12px; border-left:4px solid var(--primary);"><small>Account ${idx+1}</small><br>Email: <b>${e}</b><br>Pass: <b>${p || 'N/A'}</b></div>`;
                });
            } else if (['photo', 'video', 'audio', 'file'].includes(data.category)) {
                const apiDoc = await db.collection('users').doc("fAd8WCdkBdS8kjvdGfqUKeW2Myr1").collection('config').doc('telegram_api').get();
                const token = apiDoc.data().token;
                const tgRes = await fetch(`https://api.telegram.org/bot${token}/getFile?file_id=${data.fullContent}`);
                const tgData = await tgRes.json();
                if(tgData.ok) {
                    const fileUrl = `https://api.telegram.org/file/bot${token}/${tgData.result.file_path}`;
                    if(data.category === 'photo') html += `<img src="${fileUrl}" style="width:100%; border-radius:15px;">`;
                    else if(data.category === 'video') html += `<video controls autoplay style="width:100%; border-radius:15px;"><source src="${fileUrl}" type="video/mp4"></video>`;
                    else if(data.category === 'audio') html += `<audio controls style="width:100%;"><source src="${fileUrl}"></audio>`;
                    else html += `<div style="text-align:center; padding:30px; background:rgba(255,255,255,0.05); border-radius:15px;"><i class="fas fa-file-pdf fa-4x" style="color:var(--danger); margin-bottom:20px;"></i><br><a href="${fileUrl}" target="_blank" class="btn" style="background:var(--success); color:black;">Download</a></div>`;
                }
            }
        }
        area.innerHTML = html;
    } catch (e) {
        area.innerHTML = "<p>Loading error occurred.</p>";
    }
}

// ‡ß´. ‡¶™‡¶ø‡¶® ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶≤‡¶ú‡¶ø‡¶ï (‡¶Æ‡¶æ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡ßü‡ßá)
// ‡ßß. ‡¶™‡¶ø‡¶® ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡¶æ
function forgotPinReset() {
    const modal = document.getElementById('pin-reset-modal');
    const errorDiv = document.getElementById('reset-error-msg');
    const input = document.getElementById('master-pass-input');
    
    errorDiv.innerText = ""; // ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶è‡¶∞‡¶∞ ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ
    input.value = ""; // ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ
    modal.style.display = 'flex';
    input.focus();
}

// ‡ß®. ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶è‡¶¨‡¶Ç ‡¶™‡¶ø‡¶® ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶∏‡¶≤ ‡¶ï‡¶æ‡¶ú
async function executePinReset() {
    const user = auth.currentUser;
    const masterPass = document.getElementById('master-pass-input').value;
    const errorDiv = document.getElementById('reset-error-msg');
    const resetBtn = event.target;

    if (!user) return alert("You must be logged in to reset your password!");
    if (!masterPass) return (errorDiv.innerText = "Enter password.!");

    resetBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Checking...';
    resetBtn.disabled = true;

    try {
        // ‡¶Æ‡¶æ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡ßü‡ßá Firebase-‡¶è ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶á‡¶® ‡¶á‡¶® ‡¶ï‡¶∞‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
        await auth.signInWithEmailAndPassword(user.email, masterPass);
        
        // ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡¶≤‡ßá ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø‡¶∞ ‡¶≤‡¶ï ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ
        // ‡¶π‡¶æ‡¶∞‡ßç‡¶°‡¶ï‡ßã‡¶° ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¨‡¶æ‡¶¶‡ßá ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï user.uid ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
        await db.collection('users').doc(user.uid).collection('security').doc('app_lock').delete();
        
        resetBtn.innerHTML = "Success!";
        alert("Your PIN lock has been successfully removed! ");
        location.reload(); 
    } catch (e) {
        console.error(e);
        resetBtn.innerHTML = "RESET PIN";
        resetBtn.disabled = false;
        errorDiv.innerText = "Wrong password! Please try again. ";
    }
}
// ‡ßß. ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡¶ø‡¶Ç ‡¶≠‡¶ø‡¶â ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ (Form ‡¶è‡¶¨‡¶Ç List ‡¶è‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá)
window.switchTrainView = function(view) {
    const form = document.getElementById('train-view-form');
    const list = document.getElementById('train-view-list');
    if(view === 'form') {
        form.style.display = 'block';
        list.style.display = 'none';
        document.getElementById('edit-train-id').value = ''; // ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶Ü‡¶á‡¶°‡¶ø
    } else {
        form.style.display = 'none';
        list.style.display = 'block';
        renderTrainingList(); // ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶ï‡¶≤
    }
}

// ‡ß®. ‡¶è‡¶Ü‡¶á ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡¶ø‡¶Ç ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ (Firebase ‡¶è)
window.saveTraining = async function() {
    const q = document.getElementById('train-q').value.trim().toLowerCase();
    const a = document.getElementById('train-a').value.trim();
    const editId = document.getElementById('edit-train-id').value;

    if(!q || !a) return alert("Keyword ‡¶è‡¶¨‡¶Ç Reply ‡¶â‡¶≠‡ßü‡¶á ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!");

    const saveBtn = document.getElementById('train-save-btn');
    saveBtn.innerText = "Saving...";
    saveBtn.disabled = true;

    try {
        if(editId) {
            // ‡¶Ø‡¶¶‡¶ø ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü
            await db.collection('global_bot_training').doc(editId).update({
                keyword: q,
                reply: a,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            alert("Lesson Updated!");
        } else {
            // ‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
            await db.collection('global_bot_training').add({
                keyword: q,
                reply: a,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            alert("Lesson Saved!");
        }
        
        // ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
        document.getElementById('train-q').value = '';
        document.getElementById('train-a').value = '';
        switchTrainView('list'); // ‡¶∏‡ßá‡¶≠ ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü‡ßá ‡¶ö‡¶≤‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
    } catch(e) {
        alert("Error saving: " + e.message);
    } finally {
        saveBtn.innerText = "Save Lesson";
        saveBtn.disabled = false;
    }
}

// ‡ß©. ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡¶ø‡¶Ç ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ (History View)
function renderTrainingList() {
    const container = document.getElementById('training-list-container');
    container.innerHTML = '<p style="text-align:center;">Loading History...</p>';

    db.collection('global_bot_training').orderBy('createdAt', 'desc').onSnapshot(snap => {
        container.innerHTML = '';
        if(snap.empty) {
            container.innerHTML = '<p style="text-align:center; color:#888;">No history found.</p>';
            return;
        }
        snap.forEach(doc => {
            const data = doc.data();
            container.innerHTML += `
                <div class="setting-row" style="background:rgba(255,255,255,0.05); margin-bottom:5px; border-radius:8px;">
                    <div style="flex:1;">
                        <small style="color:var(--primary);">Q: ${data.keyword}</small><br>
                        <span style="font-size:0.85rem;">A: ${data.reply}</span>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <button onclick="editTraining('${doc.id}', '${data.keyword}', '${data.reply}')" class="edit-btn"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteTraining('${doc.id}')" class="delete-btn"><i class="fas fa-trash"></i></button>
                    </div>
                </div>`;
        });
    });
}

// ‡ß™. ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡¶ø‡¶Ç ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ
// Line 926 ‡¶è‡¶∞ ‡¶Ü‡¶∂‡ßá‡¶™‡¶æ‡¶∂‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®
window.deleteTraining = function(id) {
    window.confirmDelete("Are you sure you want to delete this lesson?", function() {
        db.collection('global_bot_training').doc(id).delete();
    });
}

// ‡ß´. ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡¶ø‡¶Ç ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ
window.editTraining = function(id, q, a) {
    document.getElementById('edit-train-id').value = id;
    document.getElementById('train-q').value = q;
    document.getElementById('train-a').value = a;
    document.getElementById('train-view-form').style.display = 'block';
    document.getElementById('train-view-list').style.display = 'none';
}

// ‡ß¨. ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö (Filter) ‡¶ï‡¶∞‡¶æ
window.filterTraining = function() {
    const term = document.getElementById('train-search').value.toLowerCase();
    const rows = document.querySelectorAll('#training-list-container .setting-row');
    rows.forEach(row => {
        const text = row.innerText.toLowerCase();
        row.style.display = text.includes(term) ? 'flex' : 'none';
    });
}

// ‡¶ï‡¶ø‡¶â‡¶Ü‡¶∞ ‡¶ï‡ßã‡¶° ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
window.downloadQRCode = function(id) {
    const container = document.getElementById(id);
    if (!container) return;

    // qrcode.js ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡¶§ ‡¶è‡¶ï‡¶ü‡¶ø canvas ‡¶Ö‡¶•‡¶¨‡¶æ img ‡¶ü‡ßç‡¶Ø‡¶æ‡¶ó ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá
    const img = container.querySelector('img');
    const canvas = container.querySelector('canvas');
    let dataUrl = "";

    if (img && img.src) {
        dataUrl = img.src;
    } else if (canvas) {
        dataUrl = canvas.toDataURL("image/png");
    }

    if (dataUrl) {
        const link = document.createElement('a');
        link.href = dataUrl;
        link.download = `QR_Code_${Date.now()}.png`; // ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡ßá‡¶Æ
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    } else {
        alert("QR ‡¶á‡¶Æ‡ßá‡¶ú‡¶ü‡¶ø ‡¶è‡¶ñ‡¶®‡ßã ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡¶®‡¶ø, ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶ï‡ßç‡¶∑‡¶£ ‡¶™‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
    }
};

</script>

</body> 
</html>